(function(t,e){"use strict";function n(t){null==t&&(t={});var n,o=e(r,t,i);for(n in t)o[n]=t[n];return o}var r,o,i;if("undefined"==typeof exports||null!=t&&t!==exports&&t!==global||(t=exports,r=global),null==r&&(r="undefined"==typeof window||null==window.document?global:window),i=r.document,o=t||r,"undefined"!=typeof exports&&exports===t)return module.exports=n(),void 0;if("function"==typeof define&&define.amd)return define(n),void 0;var l={},s=n(l);o.mask=s;for(var u in l)o[u]=l[u]})(this,function(global,exports,document){"use strict";function util_extend(t,e){null==t&&(t={});for(var n in e)hasOwnProp.call(e,n)!==!1&&(t[n]=e[n]);return t}function util_getProperty(t,e){if("."===e)return t;for(var n=t,r=e.split("."),o=-1,i=r.length;null!=n&&i>++o;)n=n[r[o]];return n}function util_interpolate(t,e,n,r,o,i,l){for(var s,u,a,c,f,h=t.length,p=0,d=null,g="",v=!0;h>p;p++)v===!0?null==d?g+=t[p]:d.push(t[p]):(c=t[p],u=null,a=c.indexOf(":"),-1===a?u=util_getProperty(n,c):(s=a>0?str_trim(c.substring(0,a)):"",""===s&&(s="expression"),c=c.substring(a+1),f=custom_Utils[s],u=fn_isFunction(f)?f(c,n,r,o,i,l,e):f.process(c,n,r,o,i,l,e)),null!=u&&("object"==typeof u&&null==d&&(d=[g]),null==d?g+=u:d.push(u))),v=!v;return null==d?g:d}function attr_extend(t,e){if(null==t&&(t={}),null==e)return t;for(var n in e)"class"!==n||"string"!=typeof t[n]?t[n]=e[n]:t[n]+=" "+e[n];return t}function Template(t){this.template=t,this.index=0,this.length=t.length}function str_trim(t){for(var e,n=t.length,r=0,o=n-1;n>r&&(e=t.charCodeAt(r),33>e);r++);for(;o>=r&&(e=t.charCodeAt(o),33>e);o--);return 0===r&&o===n-1?t:t.substring(r,o+1)}function fn_isFunction(t){return"function"==typeof t}function Node(t,e){this.type=Dom.NODE,this.tagName=t,this.parent=e,this.attr={}}function TextNode(t,e){this.content=t,this.parent=e,this.type=Dom.TEXTNODE}function Fragment(){this.nodes=[]}function Component(t,e,n){this.tagName=t,this.parent=e,this.controller=n,this.attr={}}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,listeners=null,__cfg={allowCache:!0};Template.prototype={skipWhitespace:function(){for(var t=this.template,e=this.index,n=this.length;n>e&&!(t.charCodeAt(e)>32);e++);return this.index=e,this},skipToAttributeBreak:function(){var t,e=this.template,n=this.index,r=this.length;do if(t=e.charCodeAt(++n),35===t&&123===e.charCodeAt(n+1))return this.index=n,this.sliceToChar("}"),this.index++,void 0;while(46!==t&&35!==t&&62!==t&&123!==t&&32!==t&&59!==t&&r>n);this.index=n},sliceToChar:function(t){for(var e,n,r=this.template,o=this.index,i=o,l=!1;(n=r.indexOf(t,o))>-1&&(o=n,92===r.charCodeAt(o-1));)l=!0,o++;return e=r.substring(i,o),this.index=o,l?e.replace(regexpEscapedChar[t],t):e}};var ConditionUtil=function(){function t(t,e){var n,r=e,o=t.index;if(null==r&&(t.skipWhitespace(),o=t.index,e=r=t.template.charCodeAt(t.index)),34===r||39===r)return t.index++,n=t.sliceToChar(39===r?"'":'"'),t.index++,n;do r=t.template.charCodeAt(++t.index);while(t.index<t.length&&32!==r&&33!==r&&60!==r&&61!==r&&62!==r&&40!==r&&41!==r&&38!==r&&124!==r);return n=t.template.substring(o,t.index),r=e,45===r||r>47&&58>r?n-0:116===r&&"true"===n?!0:102===r&&"false"===n?!1:{value:n}}function e(n,r){var o,i={assertions:null,join:null,left:null,right:null};null==r&&(r=[]),"string"==typeof n&&(n=new Template(n));t:for(;;){if(n.skipWhitespace(),n.index>=n.length)break;switch(o=n.template.charCodeAt(n.index)){case 61:case 60:case 62:case 33:var l=n.index;do o=n.template.charCodeAt(++n.index);while(n.index<n.length&&(60===o||61===o||62===o));i.sign=n.template.substring(l,n.index);continue;case 38:case 124:n.template.charCodeAt(++n.index)!==o&&console.error("Unary operation not valid"),i.join=38===o?"&&":"||",r.push(i),i={assertions:null,join:null,left:null,right:null},++n.index;continue;case 40:n.index++,e(n,i.assertions=[]);break;case 41:n.index++;break t;default:i[null==i.left?"left":"right"]=t(n,o);continue}}return(i.left||i.assertions)&&r.push(i),r}function n(n){if(null!=o[n])return o[n];var r=n.length,i={assertions:null,case1:null,case2:null},l=n.indexOf("?"),s=new Template(n);return-1!==l&&(s.length=l),i.assertions=e(s),-1!==l&&(s.length=r,s.index=l+1,i.case1=t(s),s.skipWhitespace(),58===s.template.charCodeAt(s.index)&&(s.index++,i.case2=t(s))),o[n]=i}function r(t,e){"string"==typeof t&&(t=n(t).assertions),null!=t.assertions&&(t=t.assertions);var o,i,l,s,u,a=!1;for(s=0,u=t.length;u>s;s++){if(o=t[s],o.assertions)a=r(o.assertions,e);else if(i="object"==typeof o.left?util_getProperty(e,o.left.value):o.left,null==o.right)a=i,"!"===o.sign&&(a=!a);else switch(l="object"==typeof o.right?util_getProperty(e,o.right.value):o.right,o.sign){case"<":a=l>i;break;case"<=":a=l>=i;break;case">":a=i>l;break;case">=":a=i>=l;break;case"!=":a=i!==l;break;case"==":a=i===l}if(a){if("&&"===o.join)continue;break}if("||"!==o.join&&"&&"===o.join)for(++s;u>s&&"||"!==t[s].join;s++);}return a}var o=[];return{condition:function(t,e){var o=n(t),i=r(o.assertions,e);return null!=o.case1&&(i=i?o.case1:o.case2),null==i?"":"object"==typeof i&&i.value?util_getProperty(e,i.value):i},isCondition:r,parse:n,out:{isCondition:r,parse:n}}}(),ExpressionUtil=function(){function t(t){this.parent=t,this.type=G,this.body=[],this.join=null}function e(t){this.parent=t}function n(t){this.type=Y,this.body=t,this.join=null}function r(t,e){this.parent=t,this.type=V,this.body=e,this.arguments=[],this.next=null}function o(t,e){this.parent=t,this.type=K,this.body=e,this.next=null}function i(t,e){this.parent=t,this.prefix=e}function l(e){this.body=e,this.case1=new t(this),this.case2=new t(this)}function s(t,e){null==t&&console.error("Undefined",t,e);var n=t.type;return G===n?(t.body.push(e),e):W===n||Q===n?t.body=e:K===n||V===n?t.next=e:(console.error("Unsupported - append:",t,e),e)}function u(){if(0===arguments.length)return null;var e=new t(arguments[0].parent);return e.join=arguments[arguments.length-1].join,e.body=Array.prototype.slice.call(arguments),e}function a(t){if(t.type!==G)return null!=t.body&&"object"==typeof t.body&&a(t.body),void 0;for(var e,n,r,o=t.body,i=0,l=o.length;l>i;i++)a(o[i]);for(i=1;l>i&&(e=o[i],n=o[i-1],!(ne[n.join]>ne[e.join]));i++);if(i!==l){for(r=[o[0]],i=1;l>i;i++)e=o[i],n=o[i-1],ne[n.join]>ne[e.join]&&l-1>i&&(e=u(o[i],o[++i])),r.push(e);t.body=r}}function c(t,e){console.error("Expression parser:",t,e,y.substring(_))}function f(t,e,n,r){var o,i,l=t,s=t.body;if(null==i&&null!=e&&(o=e,i=e[s]),null==i&&null!=n&&(o=n,i=n[s]),null==i&&null!=r)do o=r,i=r[s];while(null==i&&null!=(r=r.parent));if(null!=i)for(;;){if(l.type===V){for(var u,a=[],f=0,h=l.arguments.length;h>f;f++)u=l.arguments[f],a[f]=m(u,e,n,r);i=i.apply(o,a)}if(null==i||null==l.next)break;if(l=l.next,s=l.body,o=i,i=i[s],null==i)break}return null==i&&(null==l||null!=l.next)&&c("Mask - Accessor error - ",s),i}function h(t){for(var e,n,r=!1,o=39===t?"'":'"',i=_;(e=y.indexOf(o,_))>-1&&(_=e,92===y.charCodeAt(e-1));)r=!0,_++;return n=y.substring(i,_),r===!0&&(n=n.replace(regexpEscapedChar[o],o)),n}function p(){for(var t,e,n=_;;){if(t=y.charCodeAt(_),46===t){if(e===!0)return c("Unexpected punc"),null;e=!0}if(!((t>=48&&57>=t||46===t)&&x>_))break;_++}return+y.substring(n,_)}function d(){var t,e=_,n=y.charCodeAt(_);if(34===n||39===n)return _++,t=h(n),_++,t;for(;;){n=y.charCodeAt(_);{if(!(n>47&&58!==n&&60!==n&&61!==n&&62!==n&&63!==n&&124!==n&&x>_))break;_++}}return y.substring(e,_)}function g(t){if(null==t&&_===x)return null;switch(t){case 40:return U;case 41:return H;case 44:return F;case 46:return $;case 43:return N;case 45:return C;case 42:return A;case 47:return O;case 37:return k;case 61:return y.charCodeAt(++_)!==t?(c("Not supported (Apply directive) - view can only access model/controllers"),null):S;case 33:return 61===y.charCodeAt(_+1)?(_++,R):E;case 62:return 61===y.charCodeAt(_+1)?(_++,I):D;case 60:return 61===y.charCodeAt(_+1)?(_++,L):P;case 38:return y.charCodeAt(++_)!==t?(c("Single Binary Operator AND"),null):j;case 124:return y.charCodeAt(++_)!==t?(c("Single Binary Operator OR"),null):T;case 63:return z;case 58:return q}return t>=65&&90>=t||t>=97&&122>=t||95===t||36===t?X:t>=48&&57>=t?B:34===t||39===t?J:(c("Unexpected / Unsupported directive"),null)}function v(u){y=u,_=0,x=u.length,b=new t;var f,v,m=b,w=te;t:for(;;)if(x>_&&33>(f=y.charCodeAt(_)))_++;else{if(_>=x)break;if(v=g(f),null==v&&x>_)break;switch(v){case U:m=s(m,new e(m)),m=s(m,new t(m)),_++;continue;case H:var M=G;w===ee&&(w=te,M=V);do m=m.parent;while(null!=m&&m.type!==M);if(M===G&&(m=m.parent),null==m){c("OutOfAst Exception - body closed");break t}_++;continue;case F:if(w!==ee){c("Unexpected punctuation, comma");break t}do m=m.parent;while(null!=m&&m.type!==V);if(null==m){c("OutOfAst Exception - next argument");break t}m=m.newArgument(),_++;continue;case z:b=new l(b),m=b.case1,_++;continue;case q:m=b.case2,_++;continue;case $:f=y.charCodeAt(_+1),f>=48&&57>=f?v=B:(v=X,_++)}if(m.type===G&&(m=s(m,new e(m))),C!==v&&E!==v||null!=m.body)switch(v){case C:case N:case A:case O:case k:case j:case T:case S:case R:case D:case I:case P:case L:for(;m&&m.type!==W;)m=m.parent;if(null==m.body){c("Unexpected operator",m);break t}m.join=v;do m=m.parent;while(null!=m&&m.type!==G);null==m&&console.error("Unexpected parent",m),_++;continue;case J:case B:if(null!=m.body&&null==m.join){c("Directive Expected");break}J===v&&(_++,s(m,new n(h(f))),_++),B===v&&s(m,new n(p(f)));continue;case X:for(var K=d();x>_;){f=y.charCodeAt(_);{if(!(33>f))break;_++}}if(40===f){w=ee,_++;var Y=s(m,new r(m,K));m=Y.newArgument();continue}110===f&&"null"===K&&(K=null),102===f&&"false"===K&&(K=!1),116===f&&"true"===K&&(K=!0),m=s(m,"string"==typeof K?new o(m,K):new n(K))}else m=s(m,new i(m,v)),_++}return null==m.body&&m.type===W&&c("Unexpected end of expression"),a(b),b}function m(t,e,n,r){var o,i;if(null==t)return null;i="string"==typeof t?w.hasOwnProperty(t)===!0?w[t]:w[t]=v(t):t;var l,s,u,a=i.type;if(G===a){var c,h;t:for(l=0,u=i.body.length;u>l;l++)if(s=i.body[l],c=m(s,e,n,r),null!=h){if(h.join===j)if(o)o=c;else for(;u>l&&i.body[l].join!==T;l++);if(h.join===T){if(o)break t;if(c){o=c;break t}}switch(h.join){case C:o-=c;break;case N:o+=c;break;case O:o/=c;break;case A:o*=c;break;case k:o%=c;break;case R:o=o!=c;break;case S:o=o==c;break;case D:o=o>c;break;case I:o=o>=c;break;case P:o=c>o;break;case L:o=c>=o}h=s}else h=s,o=c}if(W===a)return m(i.body,e,n,r);if(Y===a)return i.body;if(K===a||V===a)return f(i,e,n,r);if(Q===a)switch(o=m(i.body,e,n,r),i.prefix){case C:o=-o;break;case E:o=!o}return Z===a&&(o=m(i.body,e,n,r),o=m(o?i.case1:i.case2,e,n,r)),o}var y,b,_=0,x=0,w={},C="-",N="+",O="/",A="*",k="%",T="||",j="&&",E="!",S="==",R="!=",D=">",I=">=",P="<",L="<=",M=".",U=20,H=21,F=22,$=23,z=24,q=25,X=30,J=31,B=32,G=1,W=2,K=3,V=4,Y=6,Q=9,Z=10,te=1,ee=2,ne={};ne[M]=1,ne[O]=2,ne[A]=2,ne[C]=3,ne[N]=3,ne[D]=4,ne[I]=4,ne[P]=4,ne[L]=4,ne[S]=5,ne[R]=5,ne[j]=6,ne[T]=6,e.prototype={constructor:e,type:W,join:null,body:null},r.prototype={constructor:r,newArgument:function(){var e=new t(this);return this.arguments.push(e),e}},i.prototype={constructor:i,type:Q,body:null},l.prototype={constructor:l,type:Z,case1:null,case2:null};var re=function(){function t(r){if(null==r)return null;var o,i;if(G===r.type)for(var l=0,s=r.body.length;s>l;l++)i=t(r.body[l]),o=e(o,i);if(K===r.type){for(var u=r.body,a=r.next;null!=a;){if(V===a.type)return t(a);if(K!==a.type)return console.error("Ast Exception: next should be a symbol/function ref"),null;u+="."+a.body,a=a.next}return u}switch(r.type){case W:case Q:case Z:i=t(r.body),o=e(o,i)}if(Z===r.type&&(i=t(b.case1),o=e(o,i),i=t(b.case2),o=e(o,i)),V===r.type){for(var l=0,s=r.arguments.length;s>l;l++)i=t(r.arguments[l]),o=e(o,i);i=null;var c=r;t:for(;c=c.parent;)switch(c.type){case K:i=c.body+(null==i?"":"."+i);break;case G:case W:break t;default:i=null;break t}null!=i&&(o=e(o,i)),r.next&&(i=t(r.next),o=e(o,{accessor:n(r),ref:i}))}return o}function e(t,e){if(null==t)return e;if(null==e)return t;if(("object"!=typeof t||null==t.length)&&(t=[t]),"object"!=typeof e||null==e.length)return-1===t.indexOf(e)&&t.push(e),t;for(var n=0,r=e.length;r>n;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}function n(t){var e=t;t:for(;e.parent;){switch(e.parent.type){case G:case W:break t}e=e.parent}return r(e,t.next)}function r(t,e){if(t===e||null==t)return null;if("object"!=typeof t)return t;if(null!=t.length&&"function"==typeof t.splice){for(var n=[],o=0,i=t.length;i>o;o++)n[o]=r(t[o],e);return n}var l={};for(var s in t)null!=t[s]&&"parent"!==s&&(l[s]=r(t[s],e));return l}return function(e){return"string"==typeof e&&(e=v(e)),t(e)}}();return{parse:v,eval:m,varRefs:re}}(),custom_Utils={condition:ConditionUtil.condition,expression:function(t,e,n,r,o){return ExpressionUtil.eval(t,e,n,o)}},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,b:null,strong:null,form:null},custom_Tags_defs={},Dom={NODE:1,TEXTNODE:2,FRAGMENT:3,COMPONENT:4,CONTROLLER:9,SET:10,Node:Node,TextNode:TextNode,Fragment:Fragment,Component:Component};Node.prototype={constructor:Node,type:Dom.NODE,tagName:null,parent:null,attr:null,nodes:null,__single:null},TextNode.prototype={type:Dom.TEXTNODE,content:null,parent:null},Fragment.prototype={constructor:Fragment,type:Dom.FRAGMENT,nodes:null},Component.prototype={constructor:Component,type:Dom.COMPONENT,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null};var Parser=function(t,e,n,r){function o(t){for(var e=-1;-1!==(e=t.indexOf(l,e))&&t.charCodeAt(e+1)!==a;)e++;if(-1===e)return t;for(var n,r=[],o=0,i=0;;){if(n=t.indexOf(s,e+2),-1===n)break;for(r[i++]=o===e?"":t.substring(o,e),r[i++]=t.substring(e+2,n),o=e=n+1;-1!==(e=t.indexOf(l,e))&&t.charCodeAt(e+1)!==a;)e++;if(-1===e)break}return t.length>o&&(r[i]=t.substring(o)),t=null,function(t,e,n,o,i,l){if(null==t){for(var s,u="",a=0,c=r.length;c>a;a++)s=r[a],u+=1===a%2?"~["+s+"]":s;return u}return util_interpolate(r,t,e,n,o,i,l)}}function i(t,e,n,r){var o={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal"}[n],i=t.substring(0,e).split("\n"),l=i.length,s=i[l-1].length,u=["Mask - Unexpected:",r,"at(",l,":",s,") [ in",o,"]"];console.error(u.join(" "),{stopped:t.substring(e),template:t})}var l="~",s="]",u=126,a=91,c=93;return{parse:function(l){for(var s,f,h,p,d,g,v,m,y=new n,b=y,_=2,x=3,w=0,C=l.length,N=2,O=3,A=5,k=6,T=7,j=8,E=9;;)if(C>w&&33>(g=l.charCodeAt(w)))w++;else if(47!==g||47!==l.charCodeAt(w+1)){if(x===A&&(null!=s&&(y.attr["class"]=o(s),s=null),null!=h&&(y.attr[h]=h,h=null,f=null)),null!=f){if(_===A)null==h?h=f:p=f,null!=h&&null!=p&&("class"!==h?y.attr[h]=p:s=null==s?p:s+" "+p,h=null,p=null);else if(x===O)d=null!=custom_Tags[f]?new r(f,y,custom_Tags[f]):new t(f,y),null==y.nodes?y.nodes=[d]:y.nodes.push(d),y=d,_=A;else if(x===j){if(d=new e(f,y),null==y.nodes?y.nodes=[d]:y.nodes.push(d),y.__single===!0)do y=y.parent;while(null!=y&&null!=y.__single);_=N}f=null}if(w>=C){_===A&&(null!=s&&(y.attr["class"]=o(s)),null!=h&&(y.attr[h]=h));break}if(_===E){for(y=y.parent;null!=y&&null!=y.__single;)y=y.parent;_=N}switch(g){case 123:x=_,_=N,w++;continue;case 62:x=_,_=N,w++,y.__single=!0;continue;case 59:if(null!=y.nodes){w++;continue}case 125:w++,x=_,_=E;continue;case 39:case 34:_===k?_=A:x=_=j,w++;var S,R=!1,D=!1,I=39===g?"'":'"';for(v=w;(S=l.indexOf(I,w))>-1&&(w=S,92===l.charCodeAt(S-1));)R=!0,w++;v===w&&(m=l.charCodeAt(w+1),(124===m||m===g)&&(D=!0,v=w+2,w=S=l.indexOf((124===m?"|":I)+I+I,v),-1===w&&(w=C))),f=l.substring(v,w),R===!0&&(f=f.replace(regexpEscapedChar[I],I)),f=o(f),w+=D?3:1;continue}if(_===N){if(x=O,_=O,46===g||35===g){f="div";continue}}else if(_===A)if(46===g)w++,h="class",_=T;else if(35===g)w++,h="id",_=T;else{if(61===g){w++,_=k;continue}if(null!=h){f=h;continue}}(_===k||_===T)&&(x=_,_=A);var P=null;for(v=w;C>w;){if(g=l.charCodeAt(w),g===u&&l.charCodeAt(w+1)===a){P=!0,++w;do g=l.charCodeAt(++w);while(g!==c&&C>w)}if(39===g||34===g||47===g||60===g||44===g){i(l,w,_,String.fromCharCode(g));break}if(x!==k&&(46===g||35===g))break;if(61===g||62===g||123===g||33>g||59===g)break;w++}if(f=l.substring(v,w),!f){i(l,w,_,"*EMPTY*");break}if(P===!0&&_===O){i(l,w,_,"Tag Names cannt be interpolated (in dev)");break}P===!0&&(_===A&&"class"===h)==!1&&(f=o(f))}else for(w++;10!==g&&13!==g&&C>w;)g=l.charCodeAt(++w);return null!=y.parent&&y.parent!==b&&y.parent.__single!==!0&&null!=y.nodes&&console.warn("Mask - ",y.parent.tagName,JSON.stringify(y.parent.attr),"was not proper closed."),1===b.nodes.length?b.nodes[0]:b},cleanObject:function(t){if(t instanceof Array){for(var e=0;t.length>e;e++)this.cleanObject(t[e]);return t}return delete t.parent,delete t.__single,null!=t.nodes&&this.cleanObject(t.nodes),t},setInterpolationQuotes:function(t,e){return t&&2===t.length?e&&1===e.length?(u=t.charCodeAt(0),a=t.charCodeAt(1),c=e.charCodeAt(0),s=e,l=t.charAt(0),void 0):(console.error("Interpolation End must be of 1 Character"),void 0):(console.error("Interpolation Start must contain 2 Characters"),void 0)},ensureTemplateFunction:o}}(Node,TextNode,Fragment,Component),builder_build=function(){function t(t,r,i){if(i=n(i),null==i.components||0===i.components.length)return o(t);var l=t.firstChild,u=i.ID||(i.ID=Date.now()),a="<script type='text/javascript'>("+(""+e)+"("+JSON.stringify(i)+", "+(null!=r?JSON.stringify(r):"null")+")); </script>";if(l&&l.nodeType===Dom.DOCTYPE){var c=l.nextNode;if(c){for(var f=c.firstChild;f&&"body"!==f.tagName;)f=f.nextNode;f?f.appendChild(new s(a)):console.warn("Body not found")}return o(t)}return"<script type='mask/html-template-start' id='mask-htmltemplate-"+u+"'></script>"+o(t)+"<script type='mask/html-template-end' name='mask-htmltemplate-"+u+"'></script>"+a}function e(t,n){function r(t,e,n){if(null==n&&(n=[]),t instanceof Array){for(var o,i=0,l=t.length;l>i;i++)o=t[i],r(o,e,n);return n}t.getAttribute("x-compo-id")===e&&n.push(t);var s=f.querySelectorAll('[x-compo-id="'+e+'"]');if(s.length)for(var u=n.length,i=0,l=s.length;l>i;i++)n[u++]=s[i];return n}function o(t,n,o,i){var l,s;if(t.compoName){var u=mask.getHandler(t.compoName);if(null==u)return console.error("Component Handler was not loaded:",t.compoName),void 0;l="function"==typeof u?new u(n):u,l.attr={},"function"==typeof l.renderStart&&l.renderStart(n),s=r(i,t.ID),l.ID=t.ID,"function"==typeof l.renderEnd&&l.renderEnd(s,n),null==o.components&&(o.components=[]),o.components.push(l)}if(t.components)for(var a,c=l||o,f=s&&s.length?s:i,h=0,p=t.components.length;p>h;h++)a=t.components[h],e(a,n,c,f)}var i,l={components:[]},s="mask-htmltemplate-"+t.ID,u=f.getElementById(s);if(null!=u){var a=f.getElementsByName(s)[0];if(null==u||null==a)return console.error("Invalid node range to initialize mask components"),void 0;for(var c=[],h=u.nextSibling;null!=h&&h!=a;)c.push(h),h=h.nextSibling;i=c}else i=f.body;for(var p,d=0,g=t.components.length;g>d;d++)p=t.components[d],o(p,n,l,i);Compo!==void 0&&Compo.signal.emitIn(l,"domInsert")}function n(t,e){if(null==e&&(e={}),e.compoName=t.compoName,e.ID=t.ID,t.components){for(var r,o=[],i=t.components,l=0,s=i.length;s>l;l++)r=i[l],o.push(n(r));e.components=o}return e}function r(t){return null==this.firstChild?(this.firstChild=this.lastChild=t,void 0):(this.lastChild.nextNode=t,this.lastChild=t,void 0)}function o(t){var e=t.nodeType,n="";if(Dom.FRAGMENT===e){for(t=t.firstChild;null!=t;)n+=o(t),t=t.nextNode;return n}if(Dom.DOCTYPE===e)return t.doctype;if(Dom.NODE===e){var r,i=t.tagName,l=t.attributes;n="<"+i;for(var s in l)r=l[s],n+=" "+s+'="'+("string"==typeof r?r.replace(/"/g,'\\"'):r)+'"';if(1===c[i])return n+="/>";for(n+=">",t=t.firstChild;null!=t;)n+=o(t),t=t.nextNode;return n+"</"+i+">"}return Dom.TEXTNODE===e?t.textContent:(console.error("Unknown node Type",e,t.tagName,t.textContent,null==t.firstChild),"")}function i(){}function l(t){this.tagName=t,this.attributes={}}function s(t){this.textContent=t}function u(t){this.doctype=t}function a(t,e,n,r,o){if(null==t)return r;var i,l,s,u,c,p,d=t.type;if(10===d||t instanceof Array){for(s=0,u=t.length;u>s;s++)a(t[s],e,n,r,o);return r}if(null==d&&(null!=t.tagName?d=1:null!=t.content&&(d=2)),1===d){var g,v=t.tagName,m=t.attr;try{g=f.createElement(v)}catch(y){return console.error(v,"element cannot be created. If this should be a custom handler tag, then controller is not defined"),void 0}null!=l&&(l.push(g),l=null,m["x-compo-id"]=o.ID),null!=r&&r.appendChild(g);for(c in m)"function"==typeof m[c]?(p=m[c]("attr",e,n,g,o,c),p instanceof Array&&(p=p.join(""))):p=m[c],p&&("function"==typeof custom_Attributes[c]?custom_Attributes[c](t,p,e,n,g,o,r):g.setAttribute(c,p));r=g}if(2===d){var b,_,x,w;if(_=t.content,"function"==typeof _)if(x=_("node",e,n,r,o),"string"==typeof x)r.appendChild(f.createTextNode(x));else{for(w="",s=0,u=x.length;u>s;s++)if(b=x[s],"object"!=typeof b)w+=b;else{if(""!==w&&(r.appendChild(f.createTextNode(w)),w=""),null==b.nodeType){w+=""+b;continue}r.appendChild(b)}""!==w&&r.appendChild(f.createTextNode(w))}else r.appendChild(f.createTextNode(_));return r}if(4===d){var m,C=t.controller,N="function"==typeof C?new C(e):C;if(null!=N){N.compoName=t.tagName,N.attr=m=attr_extend(N.attr,t.attr);for(c in m)"function"==typeof m[c]&&(m[c]=m[c]("attr",e,n,r,o,c));if(null!=t.nodes&&(N.nodes=t.nodes),N.parent=o,null!=listeners&&null!=listeners.compoCreated){var O=listeners.compoCreated;for(s=0,u=O.length;u>s;s++)O[s](N,e,n,r)}"function"==typeof N.renderStart&&N.renderStart(e,n,r),t=N}if(null==o.components?o.components=[t]:o.components.push(t),o=t,o.ID=++h,i=[],o.async===!0)return o.await(build_resumeDelegate(o,e,n,r)),r;if(null!=o.model&&(e=o.model),null!=N&&null!=N.tagName&&N.tagName!==t.compoName&&(N.nodes={tagName:N.tagName,attr:N.attr,nodes:N.nodes,type:1}),"function"==typeof o.render)return o.render(e,n,r),r}var A=t.nodes;if(null!=A)for(var k,T=A instanceof Array,j=T===!0?A.length:1,E=0;j>E;E++)k=T===!0?A[E]:A,4===d&&1===k.type&&(k.attr["x-compo-id"]=t.ID),a(k,e,n,r,o);return r}var c={};util_extend(Dom,{DOCTYPE:11}),i.prototype={constructor:i,nodeType:Dom.FRAGMENT,firstChild:null,lastChild:null,nextNode:null,appendChild:r},l.prototype={constructor:l,nodeType:Dom.NODE,firstChild:null,lastChild:null,nextNode:null,appendChild:r,setAttribute:function(t,e){this.attributes[t]=e},getAttribute:function(t){return this.attributes[t]}},s.prototype={constructor:s,nodeType:Dom.TEXTNODE,nextNode:null},u.prototype={constructor:u,nodeType:Dom.DOCTYPE};var f={createDocumentFragment:function(){return new i},createElement:function(t){return new l(t)},createTextNode:function(t){return new s(t)}};(function(){function t(){}custom_Tags[":document"]=t,t.prototype={render:function(t,e,n){var r=this.attr,o=this.nodes,i=r.doctype||"html";delete r.doctype,n.appendChild(new u("<!DOCTYPE "+i+">"));for(var l,s,c,f,h={tagName:"html",type:Dom.NODE,attr:r,nodes:[]},p=0,d=o.length;d>p;p++)f=o[p],"head"!==f.tagName?"body"!==f.tagName?c=!0:s=f:l=f;if(null==s&&(s={nodeType:Dom.NODE,tagName:"body",nodes:[]}),null!=l&&h.nodes.push(l),null!=s&&h.nodes.push(s),c)for(var f,p=0,d=o.length;d>p;p++)f=o[p],"head"!==f.tagName&&"body"!==f.tagName&&s.nodes.push(f);var g=this.parent;return g.components=[],a(h,t,e,n,g),n}}})();var h=0;return function(e,n,r){var o=new i,l=new Component;return a(e,n,r,o,l),t(o,n,l)}}(),cache={},Mask={render:function(t,e,n,r,o){return null!=r&&"function"!=typeof r.appendChild&&(console.error(".render(template[, model, cntx, container, controller]","Container should implement .appendChild method"),console.warn("Args:",arguments)),"string"==typeof t&&(t=hasOwnProp.call(cache,t)?cache[t]:cache[t]=Parser.parse(t)),null==n&&(n={}),builder_build(t,e,n,r,o)},compile:Parser.parse,parse:Parser.parse,build:builder_build,registerHandler:function(t,e){custom_Tags[t]=e},getHandler:function(t){return null!=t?custom_Tags[t]:custom_Tags},registerAttrHandler:function(t,e,n){fn_isFunction(e)&&(n=e),custom_Attributes[t]=n},getAttrHandler:function(t){return null!=t?custom_Attributes[t]:custom_Attributes},registerUtil:function(t,e){return"function"==typeof e?(custom_Utils[t]=e,void 0):("function"!=typeof e.process&&(e.process=function(t,e,n,r,o,i,l){return"node"===l?(this.nodeRenderStart(t,e,n,r,o),this.node(t,e,n,r,o)):(this.attrRenderStart(t,e,n,r,o,i),this.attr(t,e,n,r,o,i))}),custom_Utils[t]=e,void 0)},getUtil:function(t){return null!=t?custom_Utils[t]:custom_Utils},registerUtility:function(t,e){console.warn("@registerUtility - deprecated - use registerUtil(utilName, mix)",t),this.registerUtility=this.registerUtil,this.registerUtility(t,e)},getUtility:function(t){return console.warn("@getUtility - deprecated - use getUtil(utilName)",t),this.getUtility=this.getUtil,this.getUtility()},clearCache:function(t){"string"==typeof t?delete cache[t]:cache={}},ValueUtils:{condition:ConditionUtil.condition,out:ConditionUtil},Utils:{Condition:ConditionUtil,Expression:ExpressionUtil,getProperty:util_getProperty,ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(source){eval(source)},on:function(t,e){null==listeners&&(listeners={}),(listeners[t]||(listeners[t]=[])).push(e)},delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,compoIndex:function(t){_controllerID=t},cfg:function(){var t=arguments;if(0===t.length)return __cfg;var e;if(2===t.length)return e=t[0],__cfg[e]=t[1],void 0;var n=t[0];if("object"==typeof n)for(e in n)__cfg[e]=n[e]}};Mask.renderDom=Mask.render,function(t){var e=function(){function e(t){for(var e="";t--;)e+=" ";return e}function n(t,n,o){var i,l;null==n&&(n=0),null==o&&(i=!0,o=[]);var s=o.length;if(t.type===f.FRAGMENT&&(t=t.nodes),t instanceof Array)for(l=0;t.length>l;l++)r(t[l],n,o);else r(t,n,o);var u=e(n);for(l=s;o.length>l;l++)o[l]=u+o[l];return i?o.join(0===c?"":"\n"):void 0}function r(t,e,r){return"string"==typeof t.content?(r.push(u(t.content)),void 0):"function"==typeof t.content?(r.push(u(t.content())),void 0):i(t)?(r.push(o(t)+";"),void 0):l(t)?(r.push(o(t)+" > "),n(s(t),c,r),void 0):(r.push(o(t)+"{"),n(t.nodes,c,r),r.push("}"),void 0)}function o(t){var e=t.tagName,n=t.attr.id||"",r=t.attr["class"]||"";"function"==typeof n&&(n=n()),"function"==typeof r&&(r=r()),n&&(n=-1!==n.indexOf(" ")?"":"#"+n),r&&(r="."+r.split(" ").join("."));var o="";for(var i in t.attr)if("id"!==i&&"class"!==i){var l=t.attr[i];"function"==typeof l&&(l=l()),(a===!1||/\s/.test(l))&&(l=u(l)),o+=" "+i+"="+l}return"div"===e&&(n||r)&&(e=""),e+n+r+o}function i(t){return null==t.nodes||t.nodes instanceof Array&&0===t.nodes.length}function l(t){return t.nodes&&(t.nodes instanceof Array==!1||1===t.nodes.length)}function s(t){return t.nodes instanceof Array?t.nodes[0]:t.nodes}function u(t){return-1===t.indexOf('"')?'"'+t.trim()+'"':-1===t.indexOf("'")?"'"+t.trim()+"'":'"'+t.replace(/"/g,'\\"').trim()+'"'}var a,c,f=t.Dom;return function(e,r){return null==e?"":("string"==typeof e&&(e=t.parse(e)),"number"==typeof r?(c=r,a=0===c):(c=r&&r.indent||4,a=0===c||r&&r.minimizeAttributes),n(e))}}();t.stringify=e}(Mask),function(t){function e(){this.attr={}}function n(t,e,n,r){null==t.nodes&&Compo!==void 0&&Compo.ensureTemplate(t);var l=t.attr.foreach||t.attr.each,s=util_getProperty(e,l),u=t.nodes,a=t.attr.index||"index";if(null==s)for(var c=t;null!=c&&null==s;)s=util_getProperty(c,l),c=c.parent;if(t.nodes=[],t.model=s,t.modelRef=l,t.template=u,t.container=r,null!=s&&"object"==typeof s&&null!=s.length){for(var f,h=0,p=s.length;p>h;h++)f=o(u,s[h],h,r,t),f[a]=h,t.nodes[h]=f;for(var d in i)t[d]=i[d]}}function r(t,e,n,r){var i,l=t.attr.repeat.split(".."),s=+l[0],u=+l[1],a=t.nodes;(isNaN(s)||isNaN(u))&&console.error("Repeat attribute(from..to) invalid",t.attr.repeat),t.nodes=[];for(var c=0;u>s;s++)i=o(a,e,s,r,t),i._repeatIndex=s,t.nodes[c++]=i}function o(t,e,n,r,o){var i=new Component;return i.nodes=t,i.model=e,i.container=r,i.parent=o,i.modelRef=n,i}t.registerHandler("%",e),e.prototype={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null,visible:null,model:null,constructor:e,renderStart:function(t,e,o){var i=this.attr;if(null!=i.use){var l=i.use;return this.model=util_getProperty(t,l),this.modelRef=l,void 0}if(null==i["debugger"]){if(null!=i.visible){var s=ExpressionUtil.eval(i.visible,t,e,this.parent);return s||(this.nodes=null),void 0}if(null!=i.log){var u=i.log,a=util_getProperty(t,u);return console.log("Key: %s, Value: %s",u,a),void 0}if(null!=i.repeat&&r(this,t,e,o),null!=i["if"]){var c=i["if"];return this.state=ConditionUtil.isCondition(c,t),this.state||(this.nodes=null),void 0}if(null!=i["else"]){var f=this.parent.components,h=f&&f[f.length-1];return null!=h&&"%"===h.compoName&&null!=h.attr["if"]?(h.state&&(this.nodes=null),void 0):(console.error("Previous Node should be \"% if='condition'\"",h,this.parent),void 0)}(null!=i.each||null!=i.foreach)&&n(this,t,e,o)}},render:null};var i={append:function(e){var n;n=new Component,n.nodes=this.template,n.model=e,t.render(n,e,null,this.container,this)}}}(Mask),function(t){function e(){}function n(){}function r(){}var o={};t.templates=o,t.registerHandler(":template",e),e.prototype.render=function(){return null==this.attr.id?(console.warn("Template Should be defined with ID attribute for future lookup"),void 0):(o[this.attr.id]=this.nodes,void 0)},t.registerHandler(":import",n),n.prototype={constructor:n,attr:null,template:null,renderStart:function(){if(this.attr.id){if(this.nodes=this.template,null==this.nodes&&(this.nodes=o[this.attr.id]),null==this.nodes){for(var t,e=this,n=":template[id="+this.attr.id+"]";null==t&&null!=(e=e.parent);)null!=e.nodes&&(t=jmask(e.nodes).filter(n).get(0));null!=t&&(this.nodes=t.nodes)}null==this.nodes&&console.warn("Template could be not imported",this.attr.id)}}},t.registerHandler(":html",r),r.prototype={mode:"server:all",render:function(t,e,n){var r=jmask(this.nodes).text(t,e,this);return r?n.insertAdjacentHTML?(n.insertAdjacentHTML("beforeend",r),void 0):(this.toHtml=function(){return r},void 0):(console.warn("No HTML for node",this),void 0)}}}(Mask);var Compo=exports.Compo=function(t){function e(t){return"string"!=typeof t?t:m(t)}function n(t,e){if(null==t&&(t={}),null==e)return t;for(var n in e)t[n]=e[n];return t}function r(t){var e={};for(var n in t)e[n]=t[n];return e}function o(t,e){return function(){return t.apply(e,arguments)}}function i(t,e,n){if(null==t&&console.warn("selector is null for type",e),"object"==typeof t)return t;var r,o,i;if(null==r)switch(t[0]){case"#":r="id",t=t.substring(1),o="attr";break;case".":r="class",t=s(t.substring(1)),o="attr";break;default:r=e===g.SET?"tagName":"compoName"}return i="up"===n?"parent":e===g.SET?"nodes":"components",{key:r,prop:o,selector:t,nextKey:i}}function l(t,e,n){"string"==typeof e&&(null==n&&(n=g[t.compoName?"CONTROLLER":"SET"]),e=i(e,n));var r=e.prop?t[e.prop]:t;if(null==r)return!1;if("function"==typeof e.selector)return e.selector(r[e.key]);if(null!=e.selector.test){if(e.selector.test(r[e.key]))return!0}else if(r[e.key]==e.selector)return!0;return!1}function s(t){return function(e){return u(e,t)}}function u(t,e,n){if("string"!=typeof t)return!1;if(null==n&&(n=0),n=t.indexOf(e,n),-1===n)return!1;if(n>0&&t.charCodeAt(n-1)>32)return u(t,e,n+1);var r=t.length,o=e.length;return r-o>n&&t.charCodeAt(n+o)>32?u(t,e,n+1):!0}function a(t,e){if(t instanceof Array){for(var n,r=0,o=t.length;o>r;r++){n=t[r];var i=a(n,e);if(null!=i)return i}return null}return l(t,e)===!0?t:(t=t[e.nextKey])&&a(t,e)}function c(t,e,n){return null!=_&&(e=_(e)),null!=d?(d(t).on(e,n),void 0):null!=t.addEventListener?(t.addEventListener(e,n,!1),void 0):(t.attachEvent&&t.attachEvent("on"+e,n),void 0)}function f(t,e){return t.filter(e).add(t.find(e))}function h(t,e,n,r){return null==n?t.on(e,r):(t.on(e,n,r),t.filter(n).on(e,r),t)}function p(){}var d=global.jQuery||global.Zepto||global.$,g=t.Dom,v=Array.prototype.slice,m=t.Utils.ensureTmplFn;null!=document&&null==d&&console.warn("jQuery / Zepto etc. was not loaded before compo.js, please use Compo.config.setDOMLibrary to define dom engine");
var y={select:function(t,e){for(var n in e){var r=e[n],o=null,i=null;if(r instanceof Array&&(i=r[0],o=r.splice(1)),"string"==typeof r&&(i=r),null==r||null==i)return console.error("Unknown component child",n,e[n]),console.warn("Is this object shared within multiple compo classes? Define it in constructor!"),void 0;var l=i.indexOf(":"),s=i.substring(0,l);s=N.config.selectors[s],null==s?t.compos[n]=t.$[0].querySelector(i):(i=i.substring(++l).trim(),t.compos[n]=s(t,i));var u=t.compos[n];null!=o&&(null!=u.$&&(u=u.$),b.on(t,o,u))}}},b={on:function(t,e,n){null==n&&(n=t.$);for(var r,i=e instanceof Array,l=i?e.length:1,s=0;i?l>s:1>s;s++)if(r=i?e[s]:e,r instanceof Array)null!=_&&(r[0]=_(r[0])),n.on.apply(n,r);else for(var u in r){var a,c,f="string"==typeof r[u]?t[r[u]]:r[u],p=u.indexOf(":");-1!==p?(a=u.substring(0,p),c=u.substring(p+1).trim()):a=u,null!=_&&(a=_(a)),h(n,a,c,o(f,t))}}},_=null,x=function(){var t=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(t){return!1}}();return{touch:function(e){return t===!1?e:"click"===e?"touchend":"mousedown"===e?"touchstart":"mouseup"===e?"touchend":"mousemove"===e?"touchmove":e}}}(),w=function(){function e(t,e){return function(){new l(t).emit(e)}}function n(t,e){return null==e.pipes[t]?(console.error("Controller has no pipes to be added to collection",t,e),void 0):(null==s[t]&&(s[t]=[]),s[t].push(e),void 0)}function r(t,e){for(var n=s[t],r=n.length;--r;)n[r]===e&&(n.splice(r,1),r++)}function o(){var t=this,e=t.pipes;for(var n in e)r(n,t)}function i(t){var e=t.pipes;if(null==e)return console.error("Controller has no pipes",t),void 0;for(var r in e)n(r,t);N.attachDisposer(t,o.bind(t))}function l(t){return this instanceof l==!1?new l(t):(this.pipeName=t,this)}t.registerAttrHandler("x-pipe-signal",function(t,n,r,o,i){for(var l,s=n.split(";"),u=0,a=s.length;a>u;u++)if(l=s[u].trim(),""!==l){var f,h,p=l.substring(0,l.indexOf(":")),d=l.substring(l.indexOf(":")+1).trim(),g=d.indexOf(".");if(-1===g)return console.error('define pipeName "click: pipeName.pipeSignal"'),void 0;f=d.substring(0,g),h=d.substring(++g);var v=e(f,h);!p&&console.error("Signal: event type is not set",n),c(i,p,v)}});var s={};return l.prototype={constructor:l,emit:function(t,e){var n=s[this.pipeName],r=this.pipeName;if(null==n)return console.warn("Pipe.emit: No signals were bound to a Pipe",r),void 0;for(var o,i,l,u,a=n.length;-1!==--a;)o=n[a],i=o.pipes[r],null!=i&&(l=i[t],"function"==typeof l&&(l.apply(o,e),u=!0));u!==!0&&console.warn("No piped slot found for a signal",t,r)}},l.addController=i,l.removeController=o,{addController:i,removeController:o,emit:function(t,e,n){l(t).emit(e,n)},pipe:l}}(),C=function(){var t={};return{create:function(e){return null==e.ID?(console.warn("Component should have an ID"),void 0):(t[e.ID]=e,void 0)},resolveCompo:function(e){if(null==e)return null;var n,r,o;do{if(r=e.getAttribute("x-compo-id"),r&&(null==n&&(n=r),o=t[r],null!=o&&(o=N.find(o,{key:"ID",selector:n,nextKey:"components"}),null!=o)))return o;e=e.parentNode}while(e&&1===e.nodeType);return n&&console.warn("No controller for ID",n),null},removeCompo:function(e){null!=e.ID&&delete t[e.ID]}}}(),N=function(){function o(t){if(this instanceof o)return null;var n;if(null==t&&(t={}),null!=t.attr)for(var r in t.attr)t.attr[r]=e(t.attr[r]);var i=t.slots;if(null!=i)for(var r in i)"string"==typeof i[r]&&("function"!=typeof t[i[r]]&&console.error("Not a Function @Slot.",i[r]),i[r]=t[i[r]]);t.hasOwnProperty("constructor")&&(n=t.constructor),n=h(n,t),null==n&&(n=function(){});for(var r in p)null==t[r]&&(t[r]=p[r]),t["base_"+r]=p[r];return n.prototype=t,t=null,n}function l(t){null!=t.dispose&&t.dispose(),C.removeCompo(t);var e=0,n=t.components,r=n&&n.length;if(r)for(;r>e;e++)l(n[e])}function s(e){if(null==e.nodes){null!=e.attr.template&&(e.template=e.attr.template,delete e.attr.template);var n=e.template;if(null!=typeof n){if("string"==typeof n){if("#"===n[0]){var r=document.getElementById(n.substring(1));if(null==r)return console.error("Template holder not found by id:",n),void 0;n=r.innerHTML}n=t.parse(n)}"object"==typeof n&&(e.nodes=n)}}}function u(t,e){if("function"==typeof t.dispose){var n=t.dispose;return t.dispose=function(){e.call(this),n.call(this)},void 0}t.dispose=e}function h(t,e){var n=e.compos,o=e.pipes,i=e.attr;return null==n&&null==o&&null==e.attr?t:function(){null!=n&&(this.compos=r(this.compos)),null!=o&&w.addController(this),null!=i&&(this.attr=r(this.attr)),"function"==typeof t&&t.call(this)}}n(o,{create:function(t){var e;null==t&&(t={}),t.hasOwnProperty("constructor")&&(e=t.constructor),null==e&&(e=function(){});for(var n in p)null==t[n]&&(t[n]=p[n]),t["base_"+n]=p[n];return e.prototype=t,e},render:function(e,n,r,o){s(e);var i=[];return t.render(null==e.tagName?e.nodes:e,n,r,o,e,i),e.$=d(i),null!=e.events&&b.on(e,e.events),null!=e.compos&&y.select(e,e.compos),e},initialize:function(e,n,r,i,l){var s;null==i&&(r&&null!=r.nodeType?(i=r,r=null):n&&null!=n.nodeType&&(i=n,n=null)),"string"==typeof e&&(s=e,e=t.getHandler(s),e||console.error("Compo not found:",e));var u={controller:e,type:g.COMPONENT,tagName:s};null==l&&null!=i&&(l=C.resolveCompo(i)),null==l&&(l=new g.Component);var a=t.render(u,n,r,null,l),c=l.components[l.components.length-1];return null!=i&&(i.appendChild(a),o.signal.emitIn(c,"domInsert")),c},dispose:function(t){"function"==typeof t.dispose&&t.dispose();var e=0,n=t.components,r=n&&n.length;if(r)for(;r>e;e++)o.dispose(n[e])},find:function(t,e){return a(t,i(e,g.CONTROLLER,"down"))},closest:function(t,e){return a(t,i(e,g.CONTROLLER,"up"))},ensureTemplate:s,attachDisposer:u,config:{selectors:{$:function(t,e){var n=f(t.$,e);return 0===n.length&&console.error("Compo Selector - element not found -",e,t),n},compo:function(t,e){var n=o.find(t,e);return null==n&&console.error("Compo Selector - component not found -",e,t),n}},setDOMLibrary:function(t){d=t},eventDecorator:function(t){return"function"==typeof t?(_=t,void 0):"string"==typeof t?(_=x[t],void 0):"boolean"==typeof t&&t===!1?(_=null,void 0):void 0}},pipe:w.pipe,resource:function(t){for(var e=t;null!=e;){if(e.resource)return e.resource;e=e.parent}return include.instance()},Dom:{addEventListener:c}}),function(){function t(t,e,n){return null==t[e]&&(t[e]=[]),t[e].push(n),t}function e(t,e,n){var r=t[e];if(null!=r)for(var o,i=0,l=r.length;l>i;i++)o=r[i],null!=o&&(r[i]=null,null!=n?o.apply(this,n):o())}var n={done:function(e){return t(this,"_cbs_done",e)},fail:function(e){return t(this,"_cbs_fail",e)},always:function(e){return t(this,"_cbs_always",e)},resolve:function(){this.async=!1,e(this,"_cbs_done",arguments),e(this,"_cbs_always",arguments)},reject:function(){this.async=!1,e(this,"_cbs_fail",arguments),e(this,"_cbs_always")}},r={async:!0,await:function(t){this.resume=t}};o.pause=function(t,e){if(null==e.async){e.defers=[],e._cbs_done=null,e._cbs_fail=null,e._cbs_always=null;for(var o in n)e[o]=n[o]}e.async=!0;for(var o in r)t[o]=r[o];e.defers.push(t)},o.resume=function(t,e){t.resume&&t.resume(),t.async=!1;for(var n,r=!1,o=0,i=e.defers.length;i>o;o++)n=e.defers[o],n!==t?r===!1&&(r=null!=n):e.defers[o]=null;r===!1&&e.resolve()}}();var p={type:g.CONTROLLER,tagName:null,compoName:null,nodes:null,attr:null,slots:null,pipes:null,compos:null,events:null,onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(t,e,n){1===arguments.length&&null!=t&&t instanceof Array==!1&&null!=t[0]&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),null==this.nodes&&s(this),"function"==typeof this.onRenderStart&&this.onRenderStart(t,e,n)},renderEnd:function(t,e,n,r){1===arguments.length&&t instanceof Array==!1&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2],r=arguments[0][3]),C.create(this,t),this.$=d(t),null!=this.events&&b.on(this,this.events),null!=this.compos&&y.select(this,this.compos),"function"==typeof this.onRenderEnd&&this.onRenderEnd(t,e,n,r)},appendTo:function(t){var e="string"==typeof t?document.querySelector(t):t;if(null==e)return console.warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var n=0;this.$.length>n;n++)e.appendChild(this.$[n]);return this.emitIn("domInsert"),this},append:function(e,n,r){var o;if(null==this.$){var l="string"==typeof e?t.compile(e):e;return o=r?a(this,i(r,g.CONTROLLER,"down")):this,null==o.nodes?(this.nodes=l,this):(o.nodes=[this.nodes,l],this)}var s=t.render(e,n,null,null,this);return o=r?this.$.find(r):this.$,o.append(s),this.emitIn("domInsert"),this},find:function(t){return a(this,i(t,g.CONTROLLER,"down"))},closest:function(t){return a(this,i(t,g.CONTROLLER,"up"))},on:function(){var t=Array.prototype.slice.call(arguments);return 3>arguments.length?(console.error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&b.on(this,[t]),null==this.events?this.events=[t]:this.events instanceof Array?this.events.push(t):this.events=[t,this.events],this)},remove:function(){if(null!=this.$){this.$.remove();var t=this.parent&&this.parent.elements;if(null!=t)for(var e,n=0,r=t.length;r>n;n++){e=t[n];for(var o=0,i=this.$.length;i>o;o++)e===this.$[o]&&(t.splice(n,1),n--,r--)}this.$=null}l(this);var s=this.parent&&this.parent.components;if(null!=s){var n=s.indexOf(this);if(-1===n)return console.warn("Compo::remove - parent doesnt contains me",this),this;s.splice(n,1)}return this},slotState:function(t,e){o.slot.toggle(this,t,e)},signalState:function(t,e){o.signal.toggle(this,t,e)},emitOut:function(t){o.signal.emitOut(this,t,this,arguments.length>1?v.call(arguments,1):null)},emitIn:function(t){o.signal.emitIn(this,t,this,arguments.length>1?v.call(arguments,1):null)}};return o.prototype=p,o}();return function(){function e(t,n,r,o,i){if(null==t)return!1;var l=!1,s=null!=t.slots&&t.slots[n];if("string"==typeof s&&(s=t[s]),"function"==typeof s){l=!0;var u=null!=t.slots.__disabled&&t.slots.__disabled[n];if(u!==!0){var a=null==o?s.call(t,r):s.apply(t,[r].concat(o));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(o=a)}}if(-1===i&&null!=t.parent)return e(t.parent,n,r,o,i)||l;if(1===i&&null!=t.components)for(var c,f=t.components,h=f.length,p=0;h>p;p++)c=e(f[p],n,r,o,i),!l&&(l=c);return l}function r(t,e,n,o){if(null==t)return!1;var i=t.slots;if(null!=i&&null!=i[e]&&("string"==typeof i[e]&&(i[e]=t[i[e]]),"function"==typeof i[e])){if(o!==!0)return!0;if(null==i.__disabled||i.__disabled[e]!==!0)return!0}if(-1===n&&null!=t.parent)return r(t.parent,e,n);if(1===n&&null!=t.components)for(var l=0,s=t.components.length;s>l;l++)if(r(t.components[l],e,n))return!0;return!1}function o(t,n){return r(t,n,-1)===!1?null:function(r){var o=arguments.length>1?v.call(arguments,1):null;e(t,n,r,o,-1)}}function i(t,e,n){var r=t.slots;null!=r&&r.hasOwnProperty(e)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[e]=n===!1)}function l(t,e,n){if(i(t,e,n),null!=t.components)for(var r=0,o=t.components.length;o>r;r++)l(t.components[r],e,n)}function s(t,e,n){return null==t.$?(console.warn("Controller has no elements to toggle state"),void 0):(d().add(t.$.filter("[data-signals]")).add(t.$.find("[data-signals]")).each(function(t,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(e)&&r[n===!0?"removeAttribute":"setAttribute"]("disabled","disabled")}),void 0)}function u(t,e,n){for(var r=t,o=t;null!=(r=r.parent);)i(r,e,n),null!=r.$&&0!==r.$.length&&(o=r);l(t,e,n),s(o,e,n)}function a(t,e,n){i(t,e,n),(n||!r(t,e,-1,!0)&&!r(t,e,1,!0))&&s(t,e,n)}t.registerAttrHandler("x-signal","client",function(t,e,n,r,i,l){for(var s,u=e.split(";"),a="",f=0,h=u.length;h>f;f++)if(s=u[f].trim(),""!==s){var p=s.substring(0,s.indexOf(":")),d=s.substring(s.indexOf(":")+1).trim(),g=o(l,d);!p&&console.error("Signal: event type is not set",e),g&&(a+=","+d+",",c(i,p,g)),!g&&console.warn("No slot found for signal",d,l)}""!==a&&i.setAttribute("data-signals",a)}),n(N,{signal:{toggle:u,emitOut:function(t,n,r,o){var i=e(t,n,r,o,-1);!i&&console.warn("Signal %c%s","font-weight:bold;",n,"was not captured")},emitIn:function(t,n,r,o){e(t,n,r,o,1)},enable:function(t,e){u(t,e,!0)},disable:function(t,e){u(t,e,!1)}},slot:{toggle:a,enable:function(t,e){a(t,e,!0)},disable:function(t,e){a(t,e,!1)},invoke:function(t,e,n,r){var o=t.slots;return null==o||"function"!=typeof o[e]?(console.error("Slot not found",e,t),null):null==r?o[e].call(t,n):o[e].apply(t,[n].concat(r))}}})}(),function(){null!=d&&null!=d.fn&&(d.fn.compo=function(t){if(0===this.length)return null;var e=C.resolveCompo(this[0]);return null==t?e:a(e,i(t,g.CONTROLLER,"up"))},d.fn.model=function(t){var e=this.compo(t);if(null==e)return null;for(var n=e.model;null==n&&e.parent;)e=e.parent,n=e.model;return n})}(),t.registerHandler(":slot",p),p.prototype={constructor:p,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var e=this.expression;t.Utils.Expression.eval(e,this.model,global,this)}},N}(Mask),jmask=exports.jmask=function(t){function e(t){return"string"!=typeof t?t:_(t)}function n(t,e){if(null==t&&(t={}),null==e)return t;for(var n in e)t[n]=e[n];return t}function r(t,e){for(var n=0,r=t.length;r>n;n++)e(t[n],n)}function o(t,e){if(null==t)return console.error("Can not remove myself from parent",e),void 0;var n=t.indexOf(e);return-1===n?(console.error("Can not remove myself from parent",e,n),void 0):(t.splice(n,1),void 0)}function i(t){return null!=t&&"object"==typeof t&&null!=t.length&&"function"==typeof t.slice}function l(t,e,n){if(null==t&&console.warn("selector is null for type",e),"object"==typeof t)return t;var r,o,i,l,u,c,f,h,p,d=0,g=t.length;for(r="up"===n?C:e===m.SET?N:O;g>d;)u=t.charCodeAt(d),33>u||(c=a(t,d+1,g),46===u?(o="class",i=A,l=s(t.substring(d+1,c))):35===u?(o="id",i=A,l=t.substring(d+1,c)):91===u?(h=t.indexOf("=",d),-1===h&&console.error('Attribute Selector: should contain "="'),i=A,o=t.substring(d+1,h),u=t.charCodeAt(h+1),p=34===u||39===u?2:1,l=t.substring(h+p,c-p+1),c++):(i=null,o=e===m.SET?"tagName":"compoName",l=t.substring(d,c)),d=c,null!=f?(null==f.filters&&(f.filters=[]),f.filters.push({key:o,selector:l,prop:i})):f={key:o,prop:i,selector:l,nextKey:r,filters:null});return f}function s(t){return function(e){return u(e,t)}}function u(t,e,n){if("string"!=typeof t)return!1;if(null==n&&(n=0),n=t.indexOf(e,n),-1===n)return!1;if(n>0&&t.charCodeAt(n-1)>32)return u(t,e,n+1);var r=t.length,o=e.length;return r-o>n&&t.charCodeAt(n+o)>32?u(t,e,n+1):!0}function a(t,e,n){for(var r,o=!1,i=!1;n>e&&(r=t.charCodeAt(e),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||33>r)||o===!0||i===!0);)e++;return e}function c(t,e,n){"string"==typeof e&&(null==n&&(n=m[t.compoName?"CONTROLLER":"SET"]),e=l(e,n));var r=e.prop?t[e.prop]:t,o=!1;if(null==r)return!1;if("function"==typeof e.selector?o=e.selector(r[e.key]):null!=e.selector.test?e.selector.test(r[e.key])&&(o=!0):r[e.key]===e.selector&&(o=!0),o===!0&&null!=e.filters)for(var i,s=0,u=e.filters.length;u>s;s++)if(i=e.filters[s],c(t,i,n)===!1)return!1;return o}function f(t,e){if(null==e)return t;for(var n,r=[],o=0,i=t.length;i>o;o++)n=t[o],c(n,e)&&r.push(n);return r}function h(t,e,n){if(null==t)return n;if(null==n&&(n=[]),t instanceof Array){for(var r=0,o=t.length;o>r;r++)h(t[r],e,n);return n}c(t,e)&&n.push(t);var i=t[e.nextKey];return null!=i&&h(i,e,n),n}function p(t,e){var r={type:1,tagName:1,compoName:1,controller:1},o={parent:e};for(var i in t)1===r[i]&&(o[i]=t[i]);t.attr&&(o.attr=n({},t.attr));var l=t.nodes;if(null!=l&&l.length>0){o.nodes=[];for(var s=l instanceof Array,u=s===!0?l.length:1,a=0;u>a;a++)o.nodes[a]=p(s===!0?l[a]:l,o)}return o}function d(t){for(var e,n=t;null!=n;)e=n,n=n.nodes&&n.nodes[0];return e}function g(t,e,n,r){if(m.TEXTNODE===t.type)return"function"==typeof t.content?t.content("node",e,n,null,r):t.content;var o="";if(null!=t.nodes)for(var i,l=0,s=t.nodes.length;s>l;l++)i=t.nodes[l],o+=g(i,e,n,r);return o}function v(t){return this instanceof v==!1?new v(t):null==t?this:t.type===m.SET?t:this.add(t)}var m=t.Dom,y=t.render,b=t.parse,_=t.Utils.ensureTmplFn,x=(global.Compo||t.Compo||Compo).signal.emitIn,w=function(){function t(t,n){return t===n?(e=!0,0):1}var e=!1;return function(n){var r,o,i,l;if(e=!1,n.sort(t),e===!1)return n;for(r=[],o=0,i=0,l=n.length-1;l>o;)n[o++]===n[o]&&(r[i++]=o);for(;i--;)n.splice(r[i],1);return n}}(),C="parent",N="nodes",O="components",A="attr";return v.prototype={constructor:v,type:m.SET,length:0,components:null,add:function(t){var e,n;if("string"==typeof t&&(t=b(t)),i(t)){for(e=0,n=t.length;n>e;e++)this.add(t[e]);return this}"function"==typeof t&&null!=t.prototype.type&&(t={controller:t,type:m.COMPONENT});var r=t.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",t),this;if(r===m.FRAGMENT){var o=t.nodes;for(e=0,n=o.length;n>e;)this[this.length++]=o[e++];return this}if(r===m.CONTROLLER){if(null!=t.nodes&&t.nodes.length)for(e=t.nodes.length;0!==e;)t.nodes[--e].parent=t;null!=t.$&&(this.type=m.CONTROLLER)}return this[this.length++]=t,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(t,e,n,r){if(this.components=[],1===this.length)return y(this[0],t,e,n,r||this);null==n&&(n=document.createDocumentFragment());for(var o=0,i=this.length;i>o;o++)y(this[o],t,e,n,r||this);return n},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(t){var e;return e=v(t),e.prevObject=this,e},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(e){if(null!=e)return this.empty().append(e);if(arguments.length)return this;var n;if(0===this.length)n=new m.Node;else if(1===this.length)n=this[0];else{n=new m.Fragment;for(var r=0,o=this.length;o>r;r++)n.nodes[r]=this[r]}return t.stringify(n)},text:function(t,e,n){if("string"==typeof t&&1===arguments.length){for(var r,o=[new m.TextNode(t)],i=0,l=this.length;l>i;i++)r=this[i],r.nodes=o;return this}for(var r,s="",i=0,l=this.length;l>i;i++)r=this[i],s+=g(r,t,e,n);return s}},r(["append","prepend"],function(t){v.prototype[t]=function(e){for(var n,r,o=v(e),i=0,l=this.length;l>i;i++){r=this[i],n=o.toArray();for(var s=0,u=n.length;u>s;s++)n[s].parent=r;r.nodes=null!=r.nodes?"append"===t?r.nodes.concat(n):n.concat(r.nodes):n}return this}}),r(["appendTo"],function(t){v.prototype[t]=function(t,e,n,r){return null==r&&(r=this),null!=t.nodeType&&"function"==typeof t.appendChild?(t.appendChild(this.render(e,n,null,r)),x(r,"domInsert"),this):(v(t).append(this),this)}}),function(){function t(t){for(var e,n,r=t.split(";"),o={},i=0,l=r.length;l>i;i++)n=r[i],e=n.indexOf(":"),o[n.substring(0,e).trim()]=n.substring(e+1).trim();return o}function o(t){var e=[],n=0;for(var r in t)e[n++]=r+":"+t[r];return e.join(";")}r(["add","remove","toggle","has"],function(t){v.prototype[t+"Class"]=function(e){var n,r,o,i,l,s=this.length,u=0;if("string"!=typeof e){if("remove"===t)for(;s>u;u++)this[0].attr["class"]=null;return this}for(;s>u;u++)if(i=this[u],null!=i.attr){if(l=i.attr["class"],null==l)l=e;else{for(l=" "+l+" ",null==n&&(n=e.split(" "),o=n.length),r=0;o>r;r++)if(n[r]){var a=l.indexOf(" "+n[r]+" ")>-1;if("has"!==t)a!==!1||"add"!==t&&"toggle"!==t?a!==!0||"remove"!==t&&"toggle"!==t||(l=l.replace(" "+n[r]+" "," ")):l+=n[r]+" ";else if(a)return!0}l=l.trim()}"has"!==t&&(i.attr["class"]=l)}return"has"===t?!1:this}}),r(["attr","removeAttr","prop","removeProp"],function(t){v.prototype[t]=function(n,r){if(!n)return this;for(var o,i=this.length,l=0,s=arguments.length;i>l;l++)switch(o=this[l],t){case"attr":case"prop":if(1===s){if("string"==typeof n)return o.attr[n];for(var u in n)o.attr[u]=e(n[u])}else 2===s&&(o.attr[n]=e(r));break;case"removeAttr":case"removeProp":o.attr[n]=null}return this}}),n(v.prototype,{tag:function(t){if("string"==typeof t){for(var e=0,n=this.length;n>e;e++)this[e].tagName=t;return this}return this[0]&&this[0].tagName},css:function(e,n){var r,i,l,s=arguments.length,u=this.length,a=0;if(1===s&&"string"==typeof e)return 0===u?null:"string"==typeof this[0].attr.style?t(this[0].attr.style)[e]:null;for(;u>a;a++)if(l=this[a].attr.style,"function"!=typeof l){if(1===s&&"object"==typeof e){if(null==l){this[a].attr.style=o(e);continue}r=t(l);for(i in e)r[i]=e[i];this[a].attr.style=o(r)}if(2===s){if(null==l){this[a].attr.style=e+":"+n;continue}r=t(l),r[e]=n,this[a].attr.style=o(r)}}return this}})}(),n(v.prototype,{clone:function(){for(var t=[],e=0,n=this.length;n>e;e++)t[e]=p(this[0]);return v(t)},wrap:function(t){var e,n=v(t),r=[];if(0===n.length)return console.log("Not valid wrapper",t),this;for(var o=0,i=this.length;i>o;o++){e=i>0?n.clone():n,d(e[0]).nodes=[this[o]],r[o]=e[0];var l=this[o].parent&&this[o].parent.nodes;if(null!=l)for(var s=0,u=l.length;u>s;s++)if(l[s]===this[o]){l.splice(s,1,r[o]);break}}return v(r)},wrapAll:function(t){var e=v(t);return 0===e.length?(console.error("Not valid wrapper",t),this):(this.parent().mask(e),d(e[0]).nodes=this.toArray(),this.pushStack(e))}}),r(["empty","remove"],function(t){v.prototype[t]=function(){for(var e,n=0,r=this.length;r>n;n++)e=this[n],"empty"!==t?"remove"!==t||null!=e.parent&&o(e.parent.nodes,e):e.nodes=null;return this}}),n(v.prototype,{each:function(t,e){for(var n=0;this.length>n;n++)t.call(e||this,this[n],n);return this},eq:function(t){return-1===t?this.slice(t):this.slice(t,t+1)},get:function(t){return 0>t?this[this.length-t]:this[t]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),r(["filter","children","closest","parent","find","first","last"],function(t){v.prototype[t]=function(e){var n,r,o=[],i=null==e?null:l(e,this.type,"closest"===t?"up":"down");switch(t){case"filter":return v(f(this,i));case"children":for(n=0;this.length>n;n++)r=this[n],null!=r.nodes&&(o=o.concat(null==i?r.nodes:f(r.nodes,i)));break;case"parent":for(n=0;this.length>n;n++)r=this[n].parent,!r||r.type===m.FRAGMENT||i&&c(r,i)||o.push(r);w(o);break;case"closest":case"find":if(null==i)break;for(n=0;this.length>n;n++)h(this[n][i.nextKey],i,o);break;case"first":case"last":var s;for(n=0;this.length>n;n++)if(s="first"===t?n:this.length-n-1,r=this[s],null==i||c(r,i)){o[0]=r;break}}return this.pushStack(o)}}),v}(Mask);return Mask});