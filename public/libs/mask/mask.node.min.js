(function(e,t){"use strict";function n(e){null==e&&(e={});var n,o=t(r,e,i);for(n in e)o[n]=e[n];return o}var r,o,i;if("undefined"==typeof exports||e!==exports&&null!=e||(r=global),null==r&&(r="undefined"==typeof window||null==window.document?global:window),i=r.document,o=e||r,"undefined"!=typeof module)return module.exports=n(),void 0;if("function"==typeof define&&define.amd)return define(n),void 0;var l={},s=n(l);o.mask=s;for(var u in l)o[u]=l[u]})(this,function(global,exports,document){"use strict";function util_extend(e,t){null==e&&(e={});for(var n in t)hasOwnProp.call(t,n)!==!1&&(e[n]=t[n]);return e}function util_getProperty(e,t){if("."===t)return e;for(var n=e,r=t.split("."),o=-1,i=r.length;null!=n&&i>++o;)n=n[r[o]];return n}function util_interpolate(e,t,n,r,o,i,l){for(var s,u,a,c,f,d=e.length,p=0,h=null,g="",m=!0;d>p;p++)m===!0?null==h?g+=e[p]:h.push(e[p]):(c=e[p],u=null,a=c.indexOf(":"),-1===a?u=util_getProperty(n,c):(s=a>0?str_trim(c.substring(0,a)):"",""===s&&(s="expression"),c=c.substring(a+1),f=custom_Utils[s],u=fn_isFunction(f)?f(c,n,r,o,i,l,t):f.process(c,n,r,o,i,l,t)),null!=u&&("object"==typeof u&&null==h&&(h=[g]),null==h?g+=u:h.push(u))),m=!m;return null==h?g:h}function Template(e){this.template=e,this.index=0,this.length=e.length}function str_trim(e){for(var t,n=e.length,r=0,o=n-1;n>r&&(t=e.charCodeAt(r),33>t);r++);for(;o>=r&&(t=e.charCodeAt(o),33>t);o--);return 0===r&&o===n-1?e:e.substring(r,o+1)}function fn_isFunction(e){return"function"==typeof e}function Node(e,t){this.type=Dom.NODE,this.tagName=e,this.parent=t,this.attr={}}function TextNode(e,t){this.content=e,this.parent=t,this.type=Dom.TEXTNODE}function Fragment(){this.nodes=[]}function Component(e,t,n){this.tagName=e,this.parent=t,this.controller=n,this.attr={}}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,listeners=null;Template.prototype={skipWhitespace:function(){for(var e=this.template,t=this.index,n=this.length;n>t&&!(e.charCodeAt(t)>32);t++);return this.index=t,this},skipToAttributeBreak:function(){var e,t=this.template,n=this.index,r=this.length;do if(e=t.charCodeAt(++n),35===e&&123===t.charCodeAt(n+1))return this.index=n,this.sliceToChar("}"),this.index++,void 0;while(46!==e&&35!==e&&62!==e&&123!==e&&32!==e&&59!==e&&r>n);this.index=n},sliceToChar:function(e){for(var t,n,r=this.template,o=this.index,i=o,l=!1;(n=r.indexOf(e,o))>-1&&(o=n,92===r.charCodeAt(o-1));)l=!0,o++;return t=r.substring(i,o),this.index=o,l?t.replace(regexpEscapedChar[e],e):t}};var ConditionUtil=function(){function e(e,t){var n,r=t,o=e.index;if(null==r&&(e.skipWhitespace(),o=e.index,t=r=e.template.charCodeAt(e.index)),34===r||39===r)return e.index++,n=e.sliceToChar(39===r?"'":'"'),e.index++,n;do r=e.template.charCodeAt(++e.index);while(e.index<e.length&&32!==r&&33!==r&&60!==r&&61!==r&&62!==r&&40!==r&&41!==r&&38!==r&&124!==r);return n=e.template.substring(o,e.index),r=t,45===r||r>47&&58>r?n-0:116===r&&"true"===n?!0:102===r&&"false"===n?!1:{value:n}}function t(n,r){var o,i={assertions:null,join:null,left:null,right:null};null==r&&(r=[]),"string"==typeof n&&(n=new Template(n));e:for(;;){if(n.skipWhitespace(),n.index>=n.length)break;switch(o=n.template.charCodeAt(n.index)){case 61:case 60:case 62:case 33:var l=n.index;do o=n.template.charCodeAt(++n.index);while(n.index<n.length&&(60===o||61===o||62===o));i.sign=n.template.substring(l,n.index);continue;case 38:case 124:n.template.charCodeAt(++n.index)!==o&&console.error("Unary operation not valid"),i.join=38===o?"&&":"||",r.push(i),i={assertions:null,join:null,left:null,right:null},++n.index;continue;case 40:n.index++,t(n,i.assertions=[]);break;case 41:n.index++;break e;default:i[null==i.left?"left":"right"]=e(n,o);continue}}return(i.left||i.assertions)&&r.push(i),r}function n(n){if(null!=o[n])return o[n];var r=n.length,i={assertions:null,case1:null,case2:null},l=n.indexOf("?"),s=new Template(n);return-1!==l&&(s.length=l),i.assertions=t(s),-1!==l&&(s.length=r,s.index=l+1,i.case1=e(s),s.skipWhitespace(),58===s.template.charCodeAt(s.index)&&(s.index++,i.case2=e(s))),o[n]=i}function r(e,t){"string"==typeof e&&(e=n(e).assertions),null!=e.assertions&&(e=e.assertions);var o,i,l,s,u,a=!1;for(s=0,u=e.length;u>s;s++){if(o=e[s],o.assertions)a=r(o.assertions,t);else if(i="object"==typeof o.left?util_getProperty(t,o.left.value):o.left,null==o.right)a=i,"!"===o.sign&&(a=!a);else switch(l="object"==typeof o.right?util_getProperty(t,o.right.value):o.right,o.sign){case"<":a=l>i;break;case"<=":a=l>=i;break;case">":a=i>l;break;case">=":a=i>=l;break;case"!=":a=i!==l;break;case"==":a=i===l}if(a){if("&&"===o.join)continue;break}if("||"!==o.join&&"&&"===o.join)for(++s;u>s&&"||"!==e[s].join;s++);}return a}var o=[];return{condition:function(e,t){var o=n(e),i=r(o.assertions,t);return null!=o.case1&&(i=i?o.case1:o.case2),null==i?"":"object"==typeof i&&i.value?util_getProperty(t,i.value):i},isCondition:r,parse:n,out:{isCondition:r,parse:n}}}(),ExpressionUtil=function(){function e(e){this.parent=e,this.type=G,this.body=[],this.join=null}function t(e){this.parent=e}function n(e){this.type=Q,this.body=e,this.join=null}function r(e,t){this.parent=e,this.type=J,this.body=t,this.arguments=[],this.next=null}function o(e,t){this.parent=e,this.type=Y,this.body=t,this.next=null}function i(e,t){this.parent=e,this.prefix=t}function l(t){this.body=t,this.case1=new e(this),this.case2=new e(this)}function s(e,t){null==e&&console.error("Undefined",e,t);var n=e.type;return G===n?(e.body.push(t),t):K===n||V===n?e.body=t:Y===n||J===n?e.next=t:(console.error("Unsupported - append:",e,t),t)}function u(){if(0===arguments.length)return null;var t=new e(arguments[0].parent);return t.join=arguments[arguments.length-1].join,t.body=Array.prototype.slice.call(arguments),t}function a(e){if(e.type!==G)return null!=e.body&&"object"==typeof e.body&&a(e.body),void 0;for(var t,n,r,o=e.body,i=0,l=o.length;l>i;i++)a(o[i]);for(i=1;l>i&&(t=o[i],n=o[i-1],!(nt[n.join]>nt[t.join]));i++);if(i!==l){for(r=[o[0]],i=1;l>i;i++)t=o[i],n=o[i-1],nt[n.join]>nt[t.join]&&l-1>i&&(t=u(o[i],o[++i])),r.push(t);e.body=r}}function c(e,t){console.error("Expression parser:",e,t,y.substring(x))}function f(e,t,n,r){var o,i,l=e,s=e.body;if(null==i&&null!=t&&(o=t,i=t[s]),null==i&&null!=n&&(o=n,i=n[s]),null==i&&null!=r)do o=r,i=r[s];while(null==i&&null!=(r=r.parent));if(null!=i)for(;;){if(l.type===J){for(var u,a=[],f=0,d=l.arguments.length;d>f;f++)u=l.arguments[f],a[f]=v(u,t,n,r);i=i.apply(o,a)}if(null==i||null==l.next)break;if(l=l.next,s=l.body,o=i,i=i[s],null==i)break}return null==i&&(null==l||null!=l.next)&&c("Mask - Accessor error - ",s),i}function d(e){for(var t,n,r=!1,o=39===e?"'":'"',i=x;(t=y.indexOf(o,x))>-1&&(x=t,92===y.charCodeAt(t-1));)r=!0,x++;return n=y.substring(i,x),r===!0&&(n=n.replace(regexpEscapedChar[o],o)),n}function p(){for(var e,t,n=x;;){if(e=y.charCodeAt(x),46===e){if(t===!0)return c("Unexpected punc"),null;t=!0}if(!((e>=48&&57>=e||46===e)&&C>x))break;x++}return+y.substring(n,x)}function h(){var e,t=x,n=y.charCodeAt(x);if(34===n||39===n)return x++,e=d(n),x++,e;for(;;){n=y.charCodeAt(x);{if(!(n>47&&58!==n&&60!==n&&61!==n&&62!==n&&63!==n&&124!==n&&C>x))break;x++}}return y.substring(t,x)}function g(e){if(null==e&&x===C)return null;switch(e){case 40:return M;case 41:return H;case 44:return F;case 46:return $;case 43:return N;case 45:return _;case 42:return O;case 47:return k;case 37:return A;case 61:return y.charCodeAt(++x)!==e?(c("Not supported (Apply directive) - view can only access model/controllers"),null):R;case 33:return 61===y.charCodeAt(x+1)?(x++,D):j;case 62:return 61===y.charCodeAt(x+1)?(x++,S):I;case 60:return 61===y.charCodeAt(x+1)?(x++,P):L;case 38:return y.charCodeAt(++x)!==e?(c("Single Binary Operator AND"),null):E;case 124:return y.charCodeAt(++x)!==e?(c("Single Binary Operator OR"),null):T;case 63:return q;case 58:return X}return e>=65&&90>=e||e>=97&&122>=e||95===e||36===e?z:e>=48&&57>=e?W:34===e||39===e?B:(c("Unexpected / Unsupported directive"),null)}function m(u){y=u,x=0,C=u.length,b=new e;var f,m,v=b,w=et;e:for(;;)if(C>x&&33>(f=y.charCodeAt(x)))x++;else{if(x>=C)break;if(m=g(f),null==m&&C>x)break;switch(m){case M:v=s(v,new t(v)),v=s(v,new e(v)),x++;continue;case H:var U=G;w===tt&&(w=et,U=J);do v=v.parent;while(null!=v&&v.type!==U);if(U===G&&(v=v.parent),null==v){c("OutOfAst Exception - body closed");break e}x++;continue;case F:if(w!==tt){c("Unexpected punctuation, comma");break e}do v=v.parent;while(null!=v&&v.type!==J);if(null==v){c("OutOfAst Exception - next argument");break e}v=v.newArgument(),x++;continue;case q:b=new l(b),v=b.case1,x++;continue;case X:v=b.case2,x++;continue;case $:f=y.charCodeAt(x+1),f>=48&&57>=f?m=W:(m=z,x++)}if(v.type===G&&(v=s(v,new t(v))),_!==m&&j!==m||null!=v.body)switch(m){case _:case N:case O:case k:case A:case E:case T:case R:case D:case I:case S:case L:case P:for(;v&&v.type!==K;)v=v.parent;if(null==v.body){c("Unexpected operator",v);break e}v.join=m;do v=v.parent;while(null!=v&&v.type!==G);null==v&&console.error("Unexpected parent",v),x++;continue;case B:case W:if(null!=v.body&&null==v.join){c("Directive Expected");break}B===m&&(x++,s(v,new n(d(f))),x++),W===m&&s(v,new n(p(f)));continue;case z:for(var Y=h();C>x;){f=y.charCodeAt(x);{if(!(33>f))break;x++}}if(40===f){w=tt,x++;var Q=s(v,new r(v,Y));v=Q.newArgument();continue}110===f&&"null"===Y&&(Y=null),102===f&&"false"===Y&&(Y=!1),116===f&&"true"===Y&&(Y=!0),v=s(v,"string"==typeof Y?new o(v,Y):new n(Y))}else v=s(v,new i(v,m)),x++}return null==v.body&&v.type===K&&c("Unexpected end of expression"),a(b),b}function v(e,t,n,r){var o,i;if(null==e)return null;i="string"==typeof e?w.hasOwnProperty(e)===!0?w[e]:w[e]=m(e):e;var l,s,u,a=i.type;if(G===a){var c,d;e:for(l=0,u=i.body.length;u>l;l++)if(s=i.body[l],c=v(s,t,n,r),null!=d){if(d.join===E)if(o)o=c;else for(;u>l&&i.body[l].join!==T;l++);if(d.join===T){if(o)break e;if(c){o=c;break e}}switch(d.join){case _:o-=c;break;case N:o+=c;break;case k:o/=c;break;case O:o*=c;break;case A:o%=c;break;case D:o=o!=c;break;case R:o=o==c;break;case I:o=o>c;break;case S:o=o>=c;break;case L:o=c>o;break;case P:o=c>=o}d=s}else d=s,o=c}if(K===a)return v(i.body,t,n,r);if(Q===a)return i.body;if(Y===a||J===a)return f(i,t,n,r);if(V===a)switch(o=v(i.body,t,n,r),i.prefix){case _:o=-o;break;case j:o=!o}return Z===a&&(o=v(i.body,t,n,r),o=v(o?i.case1:i.case2,t,n,r)),o}var y,b,x=0,C=0,w={},_="-",N="+",k="/",O="*",A="%",T="||",E="&&",j="!",R="==",D="!=",I=">",S=">=",L="<",P="<=",U=".",M=20,H=21,F=22,$=23,q=24,X=25,z=30,B=31,W=32,G=1,K=2,Y=3,J=4,Q=6,V=9,Z=10,et=1,tt=2,nt={};nt[U]=1,nt[k]=2,nt[O]=2,nt[_]=3,nt[N]=3,nt[I]=4,nt[S]=4,nt[L]=4,nt[P]=4,nt[R]=5,nt[D]=5,nt[E]=6,nt[T]=6,t.prototype={constructor:t,type:K,join:null,body:null},r.prototype={constructor:r,newArgument:function(){var t=new e(this);return this.arguments.push(t),t}},i.prototype={constructor:i,type:V,body:null},l.prototype={constructor:l,type:Z,case1:null,case2:null};var rt=function(){function e(r){if(null==r)return null;var o,i;if(G===r.type)for(var l=0,s=r.body.length;s>l;l++)i=e(r.body[l]),o=t(o,i);if(Y===r.type){for(var u=r.body,a=r.next;null!=a;){if(J===a.type)return e(a);if(Y!==a.type)return console.error("Ast Exception: next should be a symbol/function ref"),null;u+="."+a.body,a=a.next}return u}switch(r.type){case K:case V:case Z:i=e(r.body),o=t(o,i)}if(Z===r.type&&(i=e(b.case1),o=t(o,i),i=e(b.case2),o=t(o,i)),J===r.type){for(var l=0,s=r.arguments.length;s>l;l++)i=e(r.arguments[l]),o=t(o,i);i=null;var c=r;e:for(;c=c.parent;)switch(c.type){case Y:i=c.body+(null==i?"":"."+i);break;case G:case K:break e;default:i=null;break e}null!=i&&(o=t(o,i)),r.next&&(i=e(r.next),o=t(o,{accessor:n(r),ref:i}))}return o}function t(e,t){if(null==e)return t;if(null==t)return e;if(("object"!=typeof e||null==e.length)&&(e=[e]),"object"!=typeof t||null==t.length)return-1===e.indexOf(t)&&e.push(t),e;for(var n=0,r=t.length;r>n;n++)-1===e.indexOf(t[n])&&e.push(t[n]);return e}function n(e){var t=e;e:for(;t.parent;){switch(t.parent.type){case G:case K:break e}t=t.parent}return r(t,e.next)}function r(e,t){if(e===t||null==e)return null;if("object"!=typeof e)return e;if(null!=e.length&&"function"==typeof e.splice){for(var n=[],o=0,i=e.length;i>o;o++)n[o]=r(e[o],t);return n}var l={};for(var s in e)null!=e[s]&&"parent"!==s&&(l[s]=r(e[s],t));return l}return function(t){return"string"==typeof t&&(t=m(t)),e(t)}}();return{parse:m,eval:v,varRefs:rt}}(),custom_Utils={condition:ConditionUtil.condition,expression:function(e,t,n,r,o){return ExpressionUtil.eval(e,t,n,o)}},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,b:null,strong:null,form:null},custom_Tags_defs={},Dom={NODE:1,TEXTNODE:2,FRAGMENT:3,COMPONENT:4,CONTROLLER:9,SET:10,Node:Node,TextNode:TextNode,Fragment:Fragment,Component:Component};Node.prototype={constructor:Node,type:Dom.NODE,tagName:null,parent:null,attr:null,nodes:null,__single:null},TextNode.prototype={type:Dom.TEXTNODE,content:null,parent:null},Fragment.prototype={constructor:Fragment,type:Dom.FRAGMENT,nodes:null},Component.prototype={constructor:Component,type:Dom.COMPONENT,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null};var Parser=function(e,t,n,r){function o(e){for(var t=-1;-1!==(t=e.indexOf(l,t))&&e.charCodeAt(t+1)!==a;)t++;if(-1===t)return e;for(var n,r=[],o=0,i=0;;){if(n=e.indexOf(s,t+2),-1===n)break;for(r[i++]=o===t?"":e.substring(o,t),r[i++]=e.substring(t+2,n),o=t=n+1;-1!==(t=e.indexOf(l,t))&&e.charCodeAt(t+1)!==a;)t++;if(-1===t)break}return e.length>o&&(r[i]=e.substring(o)),e=null,function(e,t,n,o,i,l){if(null==e){for(var s,u="",a=0,c=r.length;c>a;a++)s=r[a],u+=1===a%2?"~["+s+"]":s;return u}return util_interpolate(r,e,t,n,o,i,l)}}function i(e,t,n,r){var o={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal"}[n],i=e.substring(0,t).split("\n"),l=i.length,s=i[l-1].length,u=["Mask - Unexpected:",r,"at(",l,":",s,") [ in",o,"]"];console.error(u.join(" "),{stopped:e.substring(t),template:e})}var l="~",s="]",u=126,a=91,c=93;return{parse:function(l){for(var s,f,d,p,h,g,m,v,y=new n,b=y,x=2,C=3,w=0,_=l.length,N=2,k=3,O=5,A=6,T=7,E=8,j=9;;)if(_>w&&33>(g=l.charCodeAt(w)))w++;else if(47!==g||47!==l.charCodeAt(w+1)){if(C===O&&(null!=s&&(y.attr["class"]=o(s),s=null),null!=d&&(y.attr[d]=d,d=null,f=null)),null!=f){if(x===O)null==d?d=f:p=f,null!=d&&null!=p&&("class"!==d?y.attr[d]=p:s=null==s?p:s+" "+p,d=null,p=null);else if(C===k)h=null!=custom_Tags[f]?new r(f,y,custom_Tags[f]):new e(f,y),null==y.nodes?y.nodes=[h]:y.nodes.push(h),y=h,x=O;else if(C===E){if(h=new t(f,y),null==y.nodes?y.nodes=[h]:y.nodes.push(h),y.__single===!0)do y=y.parent;while(null!=y&&null!=y.__single);x=N}f=null}if(w>=_){x===O&&(null!=s&&(y.attr["class"]=o(s)),null!=d&&(y.attr[d]=d));break}if(x===j){for(y=y.parent;null!=y&&null!=y.__single;)y=y.parent;x=N}switch(g){case 123:C=x,x=N,w++;continue;case 62:C=x,x=N,w++,y.__single=!0;continue;case 59:if(null!=y.nodes){w++;continue}case 125:w++,C=x,x=j;continue;case 39:case 34:x===A?x=O:C=x=E,w++;var R,D=!1,I=!1,S=39===g?"'":'"';for(m=w;(R=l.indexOf(S,w))>-1&&(w=R,92===l.charCodeAt(R-1));)D=!0,w++;m===w&&(v=l.charCodeAt(w+1),(124===v||v===g)&&(I=!0,m=w+2,w=R=l.indexOf((124===v?"|":S)+S+S,m),-1===w&&(w=_))),f=l.substring(m,w),D===!0&&(f=f.replace(regexpEscapedChar[S],S)),f=o(f),w+=I?3:1;continue}if(x===N){if(C=k,x=k,46===g||35===g){f="div";continue}}else if(x===O)if(46===g)w++,d="class",x=T;else if(35===g)w++,d="id",x=T;else{if(61===g){w++,x=A;continue}if(null!=d){f=d;continue}}(x===A||x===T)&&(C=x,x=O);var L=null;for(m=w;_>w;){if(g=l.charCodeAt(w),g===u&&l.charCodeAt(w+1)===a){L=!0,++w;do g=l.charCodeAt(++w);while(g!==c&&_>w)}if(39===g||34===g||47===g||60===g||44===g){i(l,w,x,String.fromCharCode(g));break}if(C!==A&&(46===g||35===g))break;if(61===g||62===g||123===g||33>g||59===g)break;w++}if(f=l.substring(m,w),!f){i(l,w,x,"*EMPTY*");break}if(L===!0&&x===k){i(l,w,x,"Tag Names cannt be interpolated (in dev)");break}L===!0&&(x===O&&"class"===d)==!1&&(f=o(f))}else for(w++;10!==g&&13!==g&&_>w;)g=l.charCodeAt(++w);return null!=y.parent&&y.parent!==b&&y.parent.__single!==!0&&null!=y.nodes&&console.warn("Mask - ",y.parent.tagName,JSON.stringify(y.parent.attr),"was not proper closed."),1===b.nodes.length?b.nodes[0]:b},cleanObject:function(e){if(e instanceof Array){for(var t=0;e.length>t;t++)this.cleanObject(e[t]);return e}return delete e.parent,delete e.__single,null!=e.nodes&&this.cleanObject(e.nodes),e},setInterpolationQuotes:function(e,t){return e&&2===e.length?t&&1===t.length?(u=e.charCodeAt(0),a=e.charCodeAt(1),c=t.charCodeAt(0),s=t,l=e.charAt(0),void 0):(console.error("Interpolation End must be of 1 Character"),void 0):(console.error("Interpolation Start must contain 2 Characters"),void 0)},ensureTemplateFunction:o}}(Node,TextNode,Fragment,Component),builder_build=function(){function e(e,r,i){if(i=n(i),null==i.components||0===i.components.length)return o(e);var l=e.firstChild,u=i.ID||(i.ID=Date.now()),a="<script type='text/javascript'>("+(""+t)+"("+JSON.stringify(i)+", "+(null!=r?JSON.stringify(r):"null")+")); </script>";if(l&&l.nodeType===Dom.DOCTYPE){var c=l.nextNode;if(c){for(var f=c.firstChild;f&&"body"!==f.tagName;)f=f.nextNode;f?f.appendChild(new s(a)):console.warn("Body not found")}return o(e)}return"<script type='mask/html-template-start' id='mask-htmltemplate-"+u+"'></script>"+o(e)+"<script type='mask/html-template-end' name='mask-htmltemplate-"+u+"'></script>"+a}function t(e,n){function r(e,t,n){if(null==n&&(n=[]),e instanceof Array){for(var o,i=0,l=e.length;l>i;i++)o=e[i],r(o,t,n);return n}e.getAttribute("x-compo-id")===t&&n.push(e);var s=f.querySelectorAll('[x-compo-id="'+t+'"]');if(s.length)for(var u=n.length,i=0,l=s.length;l>i;i++)n[u++]=s[i];return n}function o(e,n,o,i){var l,s;if(e.compoName){var u=mask.getHandler(e.compoName);if(null==u)return console.error("Component Handler was not loaded:",e.compoName),void 0;l="function"==typeof u?new u(n):u,l.attr={},"function"==typeof l.renderStart&&l.renderStart(n),s=r(i,e.ID),l.ID=e.ID,"function"==typeof l.renderEnd&&l.renderEnd(s,n),null==o.components&&(o.components=[]),o.components.push(l)}if(e.components)for(var a,c=l||o,f=s&&s.length?s:i,d=0,p=e.components.length;p>d;d++)a=e.components[d],t(a,n,c,f)}var i,l={components:[]},s="mask-htmltemplate-"+e.ID,u=f.getElementById(s);if(null!=u){var a=f.getElementsByName(s)[0];if(null==u||null==a)return console.error("Invalid node range to initialize mask components"),void 0;for(var c=[],d=u.nextSibling;null!=d&&d!=a;)c.push(d),d=d.nextSibling;i=c}else i=f.body;for(var p,h=0,g=e.components.length;g>h;h++)p=e.components[h],o(p,n,l,i);Compo!==void 0&&Compo.signal.emitIn(l,"domInsert")}function n(e,t){if(null==t&&(t={}),t.compoName=e.compoName,t.ID=e.ID,e.components){for(var r,o=[],i=e.components,l=0,s=i.length;s>l;l++)r=i[l],o.push(n(r));t.components=o}return t}function r(e){return null==this.firstChild?(this.firstChild=this.lastChild=e,void 0):(this.lastChild.nextNode=e,this.lastChild=e,void 0)}function o(e){var t=e.nodeType,n="";if(Dom.FRAGMENT===t){for(e=e.firstChild;null!=e;)n+=o(e),e=e.nextNode;return n}if(Dom.DOCTYPE===t)return e.doctype;if(Dom.NODE===t){var r,i=e.tagName,l=e.attributes;n="<"+i;for(var s in l)r=l[s],n+=" "+s+'="'+("string"==typeof r?r.replace(/"/g,'\\"'):r)+'"';if(1===c[i])return n+="/>";for(n+=">",e=e.firstChild;null!=e;)n+=o(e),e=e.nextNode;return n+"</"+i+">"}return Dom.TEXTNODE===t?e.textContent:(console.error("Unknown node Type",t,e.tagName,e.textContent,null==e.firstChild),"")}function i(){}function l(e){this.tagName=e,this.attributes={}}function s(e){this.textContent=e}function u(e){this.doctype=e}function a(e,t,n,r,o){if(null==e)return r;var i,l,s,u,c,p,h=e.type;if(10===h||e instanceof Array){for(s=0,u=e.length;u>s;s++)a(e[s],t,n,r,o);return r}if(null==h&&(null!=e.tagName?h=1:null!=e.content&&(h=2)),1===h){var g,m=e.tagName,v=e.attr;try{g=f.createElement(m)}catch(y){return console.error(m,"element cannot be created. If this should be a custom handler tag, then controller is not defined"),void 0}null!=l&&(l.push(g),l=null,v["x-compo-id"]=o.ID),null!=r&&r.appendChild(g);for(c in v)"function"==typeof v[c]?(p=v[c]("attr",t,n,g,o,c),p instanceof Array&&(p=p.join(""))):p=v[c],p&&("function"==typeof custom_Attributes[c]?custom_Attributes[c](e,p,t,n,g,o,r):g.setAttribute(c,p));r=g}if(2===h){var b,x,C,w;if(x=e.content,"function"==typeof x)if(C=x("node",t,n,r,o),"string"==typeof C)r.appendChild(f.createTextNode(C));else{for(w="",s=0,u=C.length;u>s;s++)if(b=C[s],"object"!=typeof b)w+=b;else{if(""!==w&&(r.appendChild(f.createTextNode(w)),w=""),null==b.nodeType){w+=""+b;continue}r.appendChild(b)}""!==w&&r.appendChild(f.createTextNode(w))}else r.appendChild(f.createTextNode(x));return r}if(4===h){var v,_=e.controller,N="function"==typeof _?new _(t):_;if(null!=N){N.compoName=e.tagName,N.attr=v=util_extend(N.attr,e.attr);for(c in v)"function"==typeof v[c]&&(v[c]=v[c]("attr",t,n,r,o,c));if(null!=e.nodes&&(N.nodes=e.nodes),N.parent=o,null!=listeners&&null!=listeners.compoCreated){var k=listeners.compoCreated;for(s=0,u=k.length;u>s;s++)k[s](N,t,n,r)}"function"==typeof N.renderStart&&N.renderStart(t,n,r),e=N}if(null==o.components?o.components=[e]:o.components.push(e),o=e,o.ID=++d,i=[],o.async===!0)return o.await(build_resumeDelegate(o,t,n,r)),r;if(null!=o.model&&(t=o.model),null!=N&&null!=N.tagName&&N.tagName!==e.compoName&&(N.nodes={tagName:N.tagName,attr:N.attr,nodes:N.nodes,type:1}),"function"==typeof o.render)return o.render(t,n,r),r}var O=e.nodes;if(null!=O)for(var A,T=O instanceof Array,E=T===!0?O.length:1,j=0;E>j;j++)A=T===!0?O[j]:O,4===h&&1===A.type&&(A.attr["x-compo-id"]=e.ID),a(A,t,n,r,o);return r}var c={};util_extend(Dom,{DOCTYPE:11}),i.prototype={constructor:i,nodeType:Dom.FRAGMENT,firstChild:null,lastChild:null,nextNode:null,appendChild:r},l.prototype={constructor:l,nodeType:Dom.NODE,firstChild:null,lastChild:null,nextNode:null,appendChild:r,setAttribute:function(e,t){this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]}},s.prototype={constructor:s,nodeType:Dom.TEXTNODE,nextNode:null},u.prototype={constructor:u,nodeType:Dom.DOCTYPE};var f={createDocumentFragment:function(){return new i},createElement:function(e){return new l(e)},createTextNode:function(e){return new s(e)}};(function(){function e(){}custom_Tags[":document"]=e,e.prototype={render:function(e,t,n){var r=this.attr,o=this.nodes,i=r.doctype||"html";delete r.doctype,n.appendChild(new u("<!DOCTYPE "+i+">"));for(var l,s,c,f,d={tagName:"html",type:Dom.NODE,attr:r,nodes:[]},p=0,h=o.length;h>p;p++)f=o[p],"head"!==f.tagName?"body"!==f.tagName?c=!0:s=f:l=f;if(null==s&&(s={nodeType:Dom.NODE,tagName:"body",nodes:[]}),null!=l&&d.nodes.push(l),null!=s&&d.nodes.push(s),c)for(var f,p=0,h=o.length;h>p;p++)f=o[p],"head"!==f.tagName&&"body"!==f.tagName&&s.nodes.push(f);var g=this.parent;return g.components=[],a(d,e,t,n,g),n}}})();var d=0;return function(t,n,r){var o=new i,l=new Component;return a(t,n,r,o,l),e(o,n,l)}}(),cache={},Mask={render:function(e,t,n,r,o){return null!=r&&"function"!=typeof r.appendChild&&(console.error(".render(template[, model, cntx, container, controller]","Container should implement .appendChild method"),console.warn("Args:",arguments)),"string"==typeof e&&(e=hasOwnProp.call(cache,e)?cache[e]:cache[e]=Parser.parse(e)),null==n&&(n={}),builder_build(e,t,n,r,o)},compile:Parser.parse,parse:Parser.parse,build:builder_build,registerHandler:function(e,t){custom_Tags[e]=t},getHandler:function(e){return null!=e?custom_Tags[e]:custom_Tags},registerAttrHandler:function(e,t,n){fn_isFunction(t)&&(n=t),custom_Attributes[e]=n},getAttrHandler:function(e){return null!=e?custom_Attributes[e]:custom_Attributes},registerUtil:function(e,t){return"function"==typeof t?(custom_Utils[e]=t,void 0):("function"!=typeof t.process&&(t.process=function(e,t,n,r,o,i,l){return"node"===l?(this.nodeRenderStart(e,t,n,r,o),this.node(e,t,n,r,o)):(this.attrRenderStart(e,t,n,r,o,i),this.attr(e,t,n,r,o,i))}),custom_Utils[e]=t,void 0)},getUtil:function(e){return null!=e?custom_Utils[e]:custom_Utils},registerUtility:function(e,t){console.warn("@registerUtility - deprecated - use registerUtil(utilName, mix)",e),this.registerUtility=this.registerUtil,this.registerUtility(e,t)},getUtility:function(e){return console.warn("@getUtility - deprecated - use getUtil(utilName)",e),this.getUtility=this.getUtil,this.getUtility()},clearCache:function(e){"string"==typeof e?delete cache[e]:cache={}},ValueUtils:{condition:ConditionUtil.condition,out:ConditionUtil},Utils:{Condition:ConditionUtil,Expression:ExpressionUtil,getProperty:util_getProperty,ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(source){eval(source)},on:function(e,t){null==listeners&&(listeners={}),(listeners[e]||(listeners[e]=[])).push(t)},delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,compoIndex:function(e){_controllerID=e}};Mask.renderDom=Mask.render,function(e){var t=function(){function t(e){for(var t="";e--;)t+=" ";return t}function n(e,n,o){var i,l;null==n&&(n=0),null==o&&(i=!0,o=[]);var s=o.length;if(e.type===f.FRAGMENT&&(e=e.nodes),e instanceof Array)for(l=0;e.length>l;l++)r(e[l],n,o);else r(e,n,o);var u=t(n);for(l=s;o.length>l;l++)o[l]=u+o[l];return i?o.join(0===c?"":"\n"):void 0}function r(e,t,r){return"string"==typeof e.content?(r.push(u(e.content)),void 0):"function"==typeof e.content?(r.push(u(e.content())),void 0):i(e)?(r.push(o(e)+";"),void 0):l(e)?(r.push(o(e)+" > "),n(s(e),c,r),void 0):(r.push(o(e)+"{"),n(e.nodes,c,r),r.push("}"),void 0)}function o(e){var t=e.tagName,n=e.attr.id||"",r=e.attr["class"]||"";"function"==typeof n&&(n=n()),"function"==typeof r&&(r=r()),n&&(n=-1!==n.indexOf(" ")?"":"#"+n),r&&(r="."+r.split(" ").join("."));var o="";for(var i in e.attr)if("id"!==i&&"class"!==i){var l=e.attr[i];"function"==typeof l&&(l=l()),(a===!1||/\s/.test(l))&&(l=u(l)),o+=" "+i+"="+l}return"div"===t&&(n||r)&&(t=""),t+n+r+o}function i(e){return null==e.nodes||e.nodes instanceof Array&&0===e.nodes.length}function l(e){return e.nodes&&(e.nodes instanceof Array==!1||1===e.nodes.length)}function s(e){return e.nodes instanceof Array?e.nodes[0]:e.nodes}function u(e){return-1===e.indexOf('"')?'"'+e.trim()+'"':-1===e.indexOf("'")?"'"+e.trim()+"'":'"'+e.replace(/"/g,'\\"').trim()+'"'}var a,c,f=e.Dom;return function(t,r){return null==t?"":("string"==typeof t&&(t=e.parse(t)),"number"==typeof r?(c=r,a=0===c):(c=r&&r.indent||4,a=0===c||r&&r.minimizeAttributes),n(t))}}();e.stringify=t}(Mask),function(e){function t(){this.attr={}}function n(e,t,n,r){null==e.nodes&&Compo!==void 0&&Compo.ensureTemplate(e);var l=e.attr.foreach||e.attr.each,s=util_getProperty(t,l),u=e.nodes,a=e.attr.index||"index";if(null==s)for(var c=e;null!=c&&null==s;)s=util_getProperty(c,l),c=c.parent;if(e.nodes=[],e.model=s,e.modelRef=l,e.template=u,e.container=r,null!=s&&"object"==typeof s&&null!=s.length){for(var f,d=0,p=s.length;p>d;d++)f=o(u,s[d],d,r,e),f[a]=d,e.nodes[d]=f;for(var h in i)e[h]=i[h]}}function r(e,t,n,r){var i,l=e.attr.repeat.split(".."),s=+l[0],u=+l[1],a=e.nodes;(isNaN(s)||isNaN(u))&&console.error("Repeat attribute(from..to) invalid",e.attr.repeat),e.nodes=[];for(var c=0;u>s;s++)i=o(a,t,s,r,e),i._repeatIndex=s,e.nodes[c++]=i}function o(e,t,n,r,o){var i=new Component;return i.nodes=e,i.model=t,i.container=r,i.parent=o,i.modelRef=n,i}e.registerHandler("%",t),t.prototype={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null,visible:null,model:null,constructor:t,renderStart:function(e,t,o){var i=this.attr;if(null!=i.use){var l=i.use;return this.model=util_getProperty(e,l),this.modelRef=l,void 0}if(null==i["debugger"]){if(null!=i.visible){var s=ExpressionUtil.eval(i.visible,e,t,this.parent);return s||(this.nodes=null),void 0}if(null!=i.log){var u=i.log,a=util_getProperty(e,u);return console.log("Key: %s, Value: %s",u,a),void 0}if(null!=i.repeat&&r(this,e,t,o),null!=i["if"]){var c=i["if"];return this.state=ConditionUtil.isCondition(c,e),this.state||(this.nodes=null),void 0}if(null!=i["else"]){var f=this.parent.components,d=f&&f[f.length-1];return null!=d&&"%"===d.compoName&&null!=d.attr["if"]?(d.state&&(this.nodes=null),void 0):(console.error("Previous Node should be \"% if='condition'\"",d,this.parent),void 0)}(null!=i.each||null!=i.foreach)&&n(this,e,t,o)}},render:null};var i={append:function(t){var n;n=new Component,n.nodes=this.template,n.model=t,e.render(n,t,null,this.container,this)}}}(Mask),function(e){function t(){}function n(){}function r(){}var o={};e.templates=o,e.registerHandler(":template",t),t.prototype.render=function(){return null==this.attr.id?(console.warn("Template Should be defined with ID attribute for future lookup"),void 0):(o[this.attr.id]=this.nodes,void 0)},e.registerHandler(":import",n),n.prototype={constructor:n,attr:null,template:null,renderStart:function(){if(this.attr.id){if(this.nodes=this.template,null==this.nodes&&(this.nodes=o[this.attr.id]),null==this.nodes){for(var e,t=this,n=":template[id="+this.attr.id+"]";null==e&&null!=(t=t.parent);)null!=t.nodes&&(e=jmask(t.nodes).filter(n).get(0));null!=e&&(this.nodes=e.nodes)}null==this.nodes&&console.warn("Template could be not imported",this.attr.id)}}},e.registerHandler(":html",r),r.prototype={mode:"server:all",render:function(e,t,n){var r=jmask(this.nodes).text(e,t,this);return r?n.insertAdjacentHTML?(n.insertAdjacentHTML("beforeend",r),void 0):(this.toHtml=function(){return r},void 0):(console.warn("No HTML for node",this),void 0)}}}(Mask);var Compo=exports.Compo=function(e){function t(e){return"string"!=typeof e?e:g(e)}function n(e,t){if(null==e&&(e={}),null==t)return e;for(var n in t)e[n]=t[n];return e}function r(e){var t={};for(var n in e)t[n]=e[n];return t}function o(e,t){return function(){return e.apply(t,arguments)}}function i(e,t,n){if(null==e&&console.warn("selector is null for type",t),"object"==typeof e)return e;var r,o,i;if(null==r)switch(e[0]){case"#":r="id",e=e.substring(1),o="attr";break;case".":r="class",e=RegExp("\\b"+e.substring(1)+"\\b"),o="attr";break;default:r=t===p.SET?"tagName":"compoName"}return i="up"===n?"parent":t===p.SET?"nodes":"components",{key:r,prop:o,selector:e,nextKey:i}}function l(e,t,n){"string"==typeof t&&(null==n&&(n=p[e.compoName?"CONTROLLER":"SET"]),t=i(t,n));var r=t.prop?e[t.prop]:e;if(null==r)return!1;if(null!=t.selector.test){if(t.selector.test(r[t.key]))return!0}else if(r[t.key]==t.selector)return!0;return!1}function s(e,t){if(e instanceof Array){for(var n,r=0,o=e.length;o>r;r++){n=e[r];var i=s(n,t);if(null!=i)return i}return null}return l(e,t)===!0?e:(e=e[t.nextKey])&&s(e,t)}function u(e,t,n){return null!=d?(d(e).on(t,n),void 0):null!=e.addEventListener?(e.addEventListener(t,n,!1),void 0):(e.attachEvent&&e.attachEvent("on"+t,n),void 0)}function a(e,t){return e.filter(t).add(e.find(t))}function c(e,t,n,r){return null==n?e.on(t,r):(e.on(t,n,r),e.filter(n).on(t,r),e)}function f(){}var d=global.jQuery||global.Zepto||global.$,p=e.Dom,h=Array.prototype.slice,g=e.Utils.ensureTmplFn;null!=document&&null==d&&console.warn("jQuery / Zepto etc. was not loaded before compo.js, please use Compo.config.setDOMLibrary to define dom engine");var m={select:function(e,t){for(var n in t){var r=t[n],o=null,i=null;if(r instanceof Array&&(i=r[0],o=r.splice(1)),"string"==typeof r&&(i=r),null==r||null==i)return console.error("Unknown component child",n,t[n]),console.warn("Is this object shared within multiple compo classes? Define it in constructor!"),void 0;var l=i.indexOf(":"),s=i.substring(0,l);s=w.config.selectors[s],null==s?e.compos[n]=e.$[0].querySelector(i):(i=i.substring(++l).trim(),e.compos[n]=s(e,i));var u=e.compos[n];null!=o&&(null!=u.$&&(u=u.$),v.on(e,o,u))}}},v={on:function(e,t,n){null==n&&(n=e.$);for(var r,i=t instanceof Array,l=i?t.length:1,s=0;i?l>s:1>s;s++)if(r=i?t[s]:t,r instanceof Array)null!=y&&(r[0]=y(r[0])),n.on.apply(n,r);
else for(var u in r){var a,f,d="string"==typeof r[u]?e[r[u]]:r[u],p=u.indexOf(":");-1!==p?(a=u.substring(0,p),f=u.substring(p+1).trim()):a=u,null!=y&&(a=y(a)),c(n,a,f,o(d,e))}}},y=null,b=function(){var e=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(e){return!1}}();return{touch:function(t){return e===!1?t:"click"===t?"touchend":"mousedown"===t?"touchstart":"mouseup"===t?"touchend":"mousemove"===t?"touchmove":t}}}(),x=function(){function t(e,t){return function(){new l(e).emit(t)}}function n(e,t){return null==t.pipes[e]?(console.error("Controller has no pipes to be added to collection",e,t),void 0):(null==s[e]&&(s[e]=[]),s[e].push(t),void 0)}function r(e,t){for(var n=s[e],r=n.length;--r;)n[r]===t&&(n.splice(r,1),r++)}function o(){var e=this,t=e.pipes;for(var n in t)r(n,e)}function i(e){var t=e.pipes;if(null==t)return console.error("Controller has no pipes",e),void 0;for(var r in t)n(r,e);w.attachDisposer(e,o.bind(e))}function l(e){return this instanceof l==!1?new l(e):(this.pipeName=e,this)}e.registerAttrHandler("x-pipe-signal",function(e,n,r,o,i){for(var l,s=n.split(";"),a=0,c=s.length;c>a;a++)if(l=s[a].trim(),""!==l){var f,d,p=l.substring(0,l.indexOf(":")),h=l.substring(l.indexOf(":")+1).trim(),g=h.indexOf(".");if(-1===g)return console.error('define pipeName "click: pipeName.pipeSignal"'),void 0;f=h.substring(0,g),d=h.substring(++g);var m=t(f,d);!p&&console.error("Signal: event type is not set",n),null!=y&&(p=y(p)),u(i,p,m)}});var s={};return l.prototype={constructor:l,emit:function(e,t){var n=s[this.pipeName],r=this.pipeName;if(null==n)return console.warn("Pipe.emit: No signals were bound to a Pipe",r),void 0;for(var o,i,l,u,a=n.length;-1!==--a;)o=n[a],i=o.pipes[r],null!=i&&(l=i[e],"function"==typeof l&&(l.apply(o,t),u=!0));u!==!0&&console.warn("No piped slot found for a signal",e,r)}},l.addController=i,l.removeController=o,{addController:i,removeController:o,emit:function(e,t,n){l(e).emit(t,n)},pipe:l}}(),C=function(){var e={};return{create:function(t){return null==t.ID?(console.warn("Component should have an ID"),void 0):(e[t.ID]=t,void 0)},resolveCompo:function(t){if(null==t)return null;var n,r,o;do{if(r=t.getAttribute("x-compo-id"),r&&(null==n&&(n=r),o=e[r],null!=o&&(o=w.find(o,{key:"ID",selector:n,nextKey:"components"}),null!=o)))return o;t=t.parentNode}while(t&&1===t.nodeType);return n&&console.warn("No controller for ID",n),null},removeCompo:function(t){null!=t.ID&&delete e[t.ID]}}}(),w=function(){function o(e){if(this instanceof o)return null;var n;if(null==e&&(e={}),null!=e.attr)for(var r in e.attr)e.attr[r]=t(e.attr[r]);var i=e.slots;if(null!=i)for(var r in i)"string"==typeof i[r]&&("function"!=typeof e[i[r]]&&console.error("Not a Function @Slot.",i[r]),i[r]=e[i[r]]);e.hasOwnProperty("constructor")&&(n=e.constructor),n=g(n,e),null==n&&(n=function(){});for(var r in w)null==e[r]&&(e[r]=w[r]),e["base_"+r]=w[r];return n.prototype=e,e=null,n}function l(e){null!=e.dispose&&e.dispose(),C.removeCompo(e);var t=0,n=e.components,r=n&&n.length;if(r)for(;r>t;t++)l(n[t])}function u(t){if(null==t.nodes){null!=t.attr.template&&(t.template=t.attr.template,delete t.attr.template);var n=t.template;if(null!=typeof n){if("string"==typeof n){if("#"===n[0]){var r=document.getElementById(n.substring(1));if(null==r)return console.error("Template holder not found by id:",n),void 0;n=r.innerHTML}n=e.parse(n)}"object"==typeof n&&(t.nodes=n)}}}function c(){var e=[];return e.appendChild=function(e){this.push(e)},e}function f(e,t){if("function"==typeof e.dispose){var n=e.dispose;return e.dispose=function(){t.call(this),n.call(this)},void 0}e.dispose=t}function g(e,t){var n=t.compos,o=t.pipes,i=t.attr;return null==n&&null==o&&null==t.attr?e:function(){null!=n&&(this.compos=r(this.compos)),null!=o&&x.addController(this),null!=i&&(this.attr=r(this.attr)),"function"==typeof e&&e.call(this)}}n(o,{create:function(e){var t;null==e&&(e={}),e.hasOwnProperty("constructor")&&(t=e.constructor),null==t&&(t=function(){});for(var n in w)null==e[n]&&(e[n]=w[n]),e["base_"+n]=w[n];return t.prototype=e,t},render:function(t,n,r,o){u(t);var i=[];return e.render(null==t.tagName?t.nodes:t,n,r,o,t,i),t.$=d(i),null!=t.events&&v.on(t,t.events),null!=t.compos&&m.select(t,t.compos),t},initialize:function(t,n,r,i,l){var s;null==i&&(r&&null!=r.nodeType?(i=r,r=null):n&&null!=n.nodeType&&(i=n,n=null)),"string"==typeof t&&(s=t,t=e.getHandler(s),t||console.error("Compo not found:",t));var u={controller:t,type:p.COMPONENT,tagName:s};null==l&&null!=i&&(l=C.resolveCompo(i)),null==l&&(l=new p.Component);var a=e.render(u,n,r,null,l),c=l.components[l.components.length-1];return null!=i&&(i.appendChild(a),o.signal.emitIn(c,"domInsert")),c},dispose:function(e){"function"==typeof e.dispose&&e.dispose();var t=0,n=e.components,r=n&&n.length;if(r)for(;r>t;t++)o.dispose(n[t])},find:function(e,t){return s(e,i(t,p.CONTROLLER,"down"))},closest:function(e,t){return s(e,i(t,p.CONTROLLER,"up"))},ensureTemplate:u,attachDisposer:f,config:{selectors:{$:function(e,t){var n=a(e.$,t);return 0===n.length&&console.error("Compo Selector - element not found -",t,e),n},compo:function(e,t){var n=o.find(e,t);return null==n&&console.error("Compo Selector - component not found -",t,e),n}},setDOMLibrary:function(e){d=e},eventDecorator:function(e){return"function"==typeof e?(y=e,void 0):"string"==typeof e?(y=b[e],void 0):"boolean"==typeof e&&e===!1?(y=null,void 0):void 0}},pipe:x.pipe,resource:function(e){for(var t=e;null!=t;){if(t.resource)return t.resource;t=t.parent}return include.instance()}}),function(){function e(e,t,n){return null==e[t]&&(e[t]=[]),e[t].push(n),e}function t(e,t,n){var r=e[t];if(null!=r)for(var o,i=0,l=r.length;l>i;i++)o=r[i],null!=o&&(r[i]=null,null!=n?o.apply(this,n):o())}var n={done:function(t){return e(this,"_cbs_done",t)},fail:function(t){return e(this,"_cbs_fail",t)},always:function(t){return e(this,"_cbs_always",t)},resolve:function(){this.async=!1,t(this,"_cbs_done",arguments),t(this,"_cbs_always",arguments)},reject:function(){this.async=!1,t(this,"_cbs_fail",arguments),t(this,"_cbs_always")}},r={async:!0,await:function(e){this.resume=e}};o.pause=function(e,t){if(null==t.async){t.defers=[],t._cbs_done=null,t._cbs_fail=null,t._cbs_always=null;for(var o in n)t[o]=n[o]}t.async=!0;for(var o in r)e[o]=r[o];t.defers.push(e)},o.resume=function(e,t){e.resume&&e.resume(),e.async=!1;for(var n,r=!1,o=0,i=t.defers.length;i>o;o++)n=t.defers[o],n!==e?r===!1&&(r=null!=n):t.defers[o]=null;r===!1&&t.resolve()}}();var w={type:p.CONTROLLER,tagName:null,compoName:null,nodes:null,attr:null,slots:null,pipes:null,compos:null,events:null,onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(e,t,n){1===arguments.length&&null!=e&&e instanceof Array==!1&&null!=e[0]&&(e=arguments[0][0],t=arguments[0][1],n=arguments[0][2]),"function"==typeof this.onRenderStart&&this.onRenderStart(e,t,n),null==this.nodes&&u(this)},renderEnd:function(e,t,n,r){1===arguments.length&&e instanceof Array==!1&&(e=arguments[0][0],t=arguments[0][1],n=arguments[0][2],r=arguments[0][3]),C.create(this,e),this.$=d(e),null!=this.events&&v.on(this,this.events),null!=this.compos&&m.select(this,this.compos),"function"==typeof this.onRenderEnd&&this.onRenderEnd(e,t,n,r)},appendTo:function(e){var t="string"==typeof e?document.querySelector(e):e;if(null==t)return console.warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var n=0;this.$.length>n;n++)t.appendChild(this.$[n]);return this.emitIn("domInsert"),this},append:function(t,n,r){var o;if(null==this.$){var l="string"==typeof t?e.compile(t):t;return o=r?s(this,i(r,p.CONTROLLER,"down")):this,null==o.nodes?(this.nodes=l,this):(o.nodes=[this.nodes,l],this)}var u=e.render(t,n,null,c(),this);o=r?this.$.find(r):this.$;for(var a=0;u.length>a;a++)o.append(u[a]);return this.emitIn("domInsert"),this},find:function(e){return s(this,i(e,p.CONTROLLER,"down"))},closest:function(e){return s(this,i(e,p.CONTROLLER,"up"))},on:function(){var e=Array.prototype.slice.call(arguments);return 3>arguments.length?(console.error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&v.on(this,[e]),null==this.events?this.events=[e]:this.events instanceof Array?this.events.push(e):this.events=[e,this.events],this)},remove:function(){if(null!=this.$){this.$.remove();var e=this.parent&&this.parent.elements;if(null!=e)for(var t,n=0,r=e.length;r>n;n++){t=e[n];for(var o=0,i=this.$.length;i>o;o++)t===this.$[o]&&(e.splice(n,1),n--,r--)}this.$=null}l(this);var s=this.parent&&this.parent.components;if(null!=s){var n=s.indexOf(this);if(-1===n)return console.warn("Compo::remove - parent doesnt contains me",this),this;s.splice(n,1)}return this},slotState:function(e,t){o.slot.toggle(this,e,t)},signalState:function(e,t){o.signal.toggle(this,e,t)},emitOut:function(e){o.signal.emitOut(this,e,this,arguments.length>1?h.call(arguments,1):null)},emitIn:function(e){o.signal.emitIn(this,e,this,arguments.length>1?h.call(arguments,1):null)}};return o.prototype=w,o}();return function(){function t(e,n,r,o,i){if(null==e)return!1;var l=!1,s=null!=e.slots&&e.slots[n];if("string"==typeof s&&(s=e[s]),"function"==typeof s){l=!0;var u=null!=e.slots.__disabled&&e.slots.__disabled[n];if(u!==!0){var a=null==o?s.call(e,r):s.apply(e,[r].concat(o));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(o=a)}}if(-1===i&&null!=e.parent)return t(e.parent,n,r,o,i)||l;if(1===i&&null!=e.components)for(var c,f=e.components,d=f.length,p=0;d>p;p++)c=t(f[p],n,r,o,i),!l&&(l=c);return l}function r(e,t,n,o){if(null==e)return!1;var i=e.slots;if(null!=i&&null!=i[t]&&("string"==typeof i[t]&&(i[t]=e[i[t]]),"function"==typeof i[t])){if(o!==!0)return!0;if(null==i.__disabled||i.__disabled[t]!==!0)return!0}if(-1===n&&null!=e.parent)return r(e.parent,t,n);if(1===n&&null!=e.components)for(var l=0,s=e.components.length;s>l;l++)if(r(e.components[l],t,n))return!0;return!1}function o(e,n){return r(e,n,-1)===!1?null:function(r){var o=arguments.length>1?h.call(arguments,1):null;t(e,n,r,o,-1)}}function i(e,t,n){var r=e.slots;null!=r&&r.hasOwnProperty(t)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[t]=n===!1)}function l(e,t,n){if(i(e,t,n),null!=e.components)for(var r=0,o=e.components.length;o>r;r++)l(e.components[r],t,n)}function s(e,t,n){return null==e.$?(console.warn("Controller has no elements to toggle state"),void 0):(d().add(e.$.filter("[data-signals]")).add(e.$.find("[data-signals]")).each(function(e,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(t)&&r[n===!0?"removeAttribute":"setAttribute"]("disabled","disabled")}),void 0)}function a(e,t,n){for(var r=e,o=e;null!=(r=r.parent);)i(r,t,n),null!=r.$&&0!==r.$.length&&(o=r);l(e,t,n),s(o,t,n)}function c(e,t,n){i(e,t,n),(n||!r(e,t,-1,!0)&&!r(e,t,1,!0))&&s(e,t,n)}e.registerAttrHandler("x-signal","client",function(e,t,n,r,i,l){for(var s,a=t.split(";"),c="",f=0,d=a.length;d>f;f++)if(s=a[f].trim(),""!==s){var p=s.substring(0,s.indexOf(":")),h=s.substring(s.indexOf(":")+1).trim(),g=o(l,h);!p&&console.error("Signal: event type is not set",t),g&&(null!=y&&(p=y(p)),c+=","+h+",",u(i,p,g)),!g&&console.warn("No slot found for signal",h,l)}""!==c&&i.setAttribute("data-signals",c)}),n(w,{signal:{toggle:a,emitOut:function(e,n,r,o){var i=t(e,n,r,o,-1);!i&&console.warn("Signal %c%s","font-weight:bold;",n,"was not captured")},emitIn:function(e,n,r,o){t(e,n,r,o,1)},enable:function(e,t){a(e,t,!0)},disable:function(e,t){a(e,t,!1)}},slot:{toggle:c,enable:function(e,t){c(e,t,!0)},disable:function(e,t){c(e,t,!1)},invoke:function(e,t,n,r){var o=e.slots;return null==o||"function"!=typeof o[t]?(console.error("Slot not found",t,e),null):null==r?o[t].call(e,n):o[t].apply(e,[n].concat(r))}}})}(),function(){null!=d&&null!=d.fn&&(d.fn.compo=function(e){if(0===this.length)return null;var t=C.resolveCompo(this[0]);return null==e?t:s(t,i(e,p.CONTROLLER,"up"))},d.fn.model=function(e){var t=this.compo(e);if(null==t)return null;for(var n=t.model;null==n&&t.parent;)t=t.parent,n=t.model;return n})}(),e.registerHandler(":slot",f),f.prototype={constructor:f,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var t=this.expression;e.Utils.Expression.eval(t,this.model,global,this)}},w}(Mask),jmask=exports.jmask=function(e){function t(e){return"string"!=typeof e?e:x(e)}function n(e,t){if(null==e&&(e={}),null==t)return e;for(var n in t)e[n]=t[n];return e}function r(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n],n)}function o(e,t){if(null==e)return console.error("Can not remove myself from parent",t),void 0;var n=e.indexOf(t);return-1===n?(console.error("Can not remove myself from parent",t,n),void 0):(e.splice(n,1),void 0)}function i(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.slice}function l(e,t,n){if(null==e&&console.warn("selector is null for type",t),"object"==typeof e)return e;var r,o,i,l,u,c,f,d,p,h=0,g=e.length;for(r="up"===n?_:t===v.SET?N:k;g>h;)u=e.charCodeAt(h),33>u||(c=a(e,h+1,g),46===u?(o="class",i=O,l=s(e.substring(h+1,c))):35===u?(o="id",i=O,l=e.substring(h+1,c)):91===u?(d=e.indexOf("=",h),-1===d&&console.error('Attribute Selector: should contain "="'),i=O,o=e.substring(h+1,d),u=e.charCodeAt(d+1),p=34===u||39===u?2:1,l=e.substring(d+p,c-p+1),c++):(i=null,o=t===v.SET?"tagName":"compoName",l=e.substring(h,c)),h=c,null!=f?(null==f.filters&&(f.filters=[]),f.filters.push({key:o,selector:l,prop:i})):f={key:o,prop:i,selector:l,nextKey:r,filters:null});return f}function s(e){return function(t){return u(t,e)}}function u(e,t,n){if(null==e)return!1;if(null==n&&(n=0),n=e.indexOf(t,n),-1===n)return!1;if(n>0&&e.charCodeAt(n-1)>32)return u(e,t,n+1);var r=e.length,o=t.length;return r-o>n&&e.charCodeAt(n+o)>32?u(e,t,n+1):!0}function a(e,t,n){for(var r,o=!1,i=!1;n>t&&(r=e.charCodeAt(t),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||33>r)||o===!0||i===!0);)t++;return t}function c(e,t,n){"string"==typeof t&&(null==n&&(n=v[e.compoName?"CONTROLLER":"SET"]),t=l(t,n));var r=t.prop?e[t.prop]:e,o=!1;if(null==r)return!1;if("function"==typeof t.selector?o=t.selector(r[t.key]):null!=t.selector.test?t.selector.test(r[t.key])&&(o=!0):r[t.key]===t.selector&&(o=!0),o===!0&&null!=t.filters)for(var i,s=0,u=t.filters.length;u>s;s++)if(i=t.filters[s],c(e,i,n)===!1)return!1;return o}function f(e,t){if(null==t)return e;for(var n,r=[],o=0,i=e.length;i>o;o++)n=e[o],c(n,t)&&r.push(n);return r}function d(e,t,n){if(null==e)return n;if(null==n&&(n=[]),e instanceof Array){for(var r=0,o=e.length;o>r;r++)d(e[r],t,n);return n}c(e,t)&&n.push(e);var i=e[t.nextKey];return null!=i&&d(i,t,n),n}function p(e,t){var r={type:1,tagName:1,compoName:1,controller:1},o={parent:t};for(var i in e)1===r[i]&&(o[i]=e[i]);e.attr&&(o.attr=n({},e.attr));var l=e.nodes;if(null!=l&&l.length>0){o.nodes=[];for(var s=l instanceof Array,u=s===!0?l.length:1,a=0;u>a;a++)o.nodes[a]=p(s===!0?l[a]:l,o)}return o}function h(e){for(var t,n=e;null!=n;)t=n,n=n.nodes&&n.nodes[0];return t}function g(e,t,n,r){if(v.TEXTNODE===e.type)return"function"==typeof e.content?e.content("node",t,n,null,r):e.content;var o="";if(null!=e.nodes)for(var i,l=0,s=e.nodes.length;s>l;l++)i=e.nodes[l],o+=g(i,t,n,r);return o}function m(e){return this instanceof m==!1?new m(e):null==e?this:e.type===v.SET?e:this.add(e)}var v=e.Dom,y=e.render,b=e.parse,x=e.Utils.ensureTmplFn,C=(global.Compo||e.Compo||Compo).signal.emitIn,w=function(){function e(e,n){return e===n?(t=!0,0):1}var t=!1;return function(n){var r,o,i,l;if(t=!1,n.sort(e),t===!1)return n;for(r=[],o=0,i=0,l=n.length-1;l>o;)n[o++]===n[o]&&(r[i++]=o);for(;i--;)n.splice(r[i],1);return n}}(),_="parent",N="nodes",k="components",O="attr";return m.prototype={constructor:m,type:v.SET,length:0,components:null,add:function(e){var t,n;if("string"==typeof e&&(e=b(e)),i(e)){for(t=0,n=e.length;n>t;t++)this.add(e[t]);return this}"function"==typeof e&&null!=e.prototype.type&&(e={controller:e,type:v.COMPONENT});var r=e.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",e),this;if(r===v.FRAGMENT){var o=e.nodes;for(t=0,n=o.length;n>t;)this[this.length++]=o[t++];return this}if(r===v.CONTROLLER){if(null!=e.nodes&&e.nodes.length)for(t=e.nodes.length;0!==t;)e.nodes[--t].parent=e;null!=e.$&&(this.type=v.CONTROLLER)}return this[this.length++]=e,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(e,t,n,r){if(this.components=[],1===this.length)return y(this[0],e,t,n,r||this);null==n&&(n=document.createDocumentFragment());for(var o=0,i=this.length;i>o;o++)y(this[o],e,t,n,r||this);return n},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(e){var t;return t=m(e),t.prevObject=this,t},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(t){if(null!=t)return this.empty().append(t);if(arguments.length)return this;var n;if(0===this.length)n=new v.Node;else if(1===this.length)n=this[0];else{n=new v.Fragment;for(var r=0,o=this.length;o>r;r++)n.nodes[r]=this[r]}return e.stringify(n)},text:function(e,t,n){if("string"==typeof e){for(var r,o=[new v.TextNode(e)],i=0,l=this.length;l>i;i++)r=this[i],r.nodes=o;return this}for(var r,s="",i=0,l=this.length;l>i;i++)r=this[i],s+=g(r,e,t,n);return s}},r(["append","prepend"],function(e){m.prototype[e]=function(t){for(var n,r,o=m(t),i=0,l=this.length;l>i;i++){r=this[i],n=o.toArray();for(var s=0,u=n.length;u>s;s++)n[s].parent=r;r.nodes=null!=r.nodes?"append"===e?r.nodes.concat(n):n.concat(r.nodes):n}return this}}),r(["appendTo"],function(e){m.prototype[e]=function(e,t,n,r){return null==r&&(r=this),null!=e.nodeType&&"function"==typeof e.appendChild?(e.appendChild(this.render(t,n,null,r)),C(r,"domInsert"),this):(m(e).append(this),this)}}),function(){function e(e){for(var t,n,r=e.split(";"),o={},i=0,l=r.length;l>i;i++)n=r[i],t=n.indexOf(":"),o[n.substring(0,t).trim()]=n.substring(t+1).trim();return o}function o(e){var t=[],n=0;for(var r in e)t[n++]=r+":"+e[r];return t.join(";")}r(["add","remove","toggle","has"],function(e){m.prototype[e+"Class"]=function(t){var n,r,o,i,l,s=this.length,u=0;if("string"!=typeof t){if("remove"===e)for(;s>u;u++)this[0].attr["class"]=null;return this}for(;s>u;u++)if(i=this[u],null!=i.attr){if(l=i.attr["class"],null==l)l=t;else{for(l=" "+l+" ",null==n&&(n=t.split(" "),o=n.length),r=0;o>r;r++)if(n[r]){var a=l.indexOf(" "+n[r]+" ")>-1;if("has"!==e)a!==!1||"add"!==e&&"toggle"!==e?a!==!0||"remove"!==e&&"toggle"!==e||(l=l.replace(" "+n[r]+" "," ")):l+=n[r]+" ";else if(a)return!0}l=l.trim()}"has"!==e&&(i.attr["class"]=l)}return"has"===e?!1:this}}),r(["attr","removeAttr","prop","removeProp"],function(e){m.prototype[e]=function(n,r){if(!n)return this;for(var o,i=this.length,l=0,s=arguments.length;i>l;l++)switch(o=this[l],e){case"attr":case"prop":if(1===s){if("string"==typeof n)return o.attr[n];for(var u in n)o.attr[u]=t(n[u])}else 2===s&&(o.attr[n]=t(r));break;case"removeAttr":case"removeProp":o.attr[n]=null}return this}}),n(m.prototype,{tag:function(e){if("string"==typeof e){for(var t=0,n=this.length;n>t;t++)this[t].tagName=e;return this}return this[0]&&this[0].tagName},css:function(t,n){var r,i,l,s=arguments.length,u=this.length,a=0;if(1===s&&"string"==typeof t)return 0===u?null:"string"==typeof this[0].attr.style?e(this[0].attr.style)[t]:null;for(;u>a;a++)if(l=this[a].attr.style,"function"!=typeof l){if(1===s&&"object"==typeof t){if(null==l){this[a].attr.style=o(t);continue}r=e(l);for(i in t)r[i]=t[i];this[a].attr.style=o(r)}if(2===s){if(null==l){this[a].attr.style=t+":"+n;continue}r=e(l),r[t]=n,this[a].attr.style=o(r)}}return this}})}(),n(m.prototype,{clone:function(){for(var e=[],t=0,n=this.length;n>t;t++)e[t]=p(this[0]);return m(e)},wrap:function(e){var t,n=m(e),r=[];if(0===n.length)return console.log("Not valid wrapper",e),this;for(var o=0,i=this.length;i>o;o++)t=i>0?n.clone():n,h(t[0]).nodes=[this[o]],r[o]=t[0],null!=this[o].parent&&(this[o].parent.nodes=r[o]);return m(r)},wrapAll:function(e){var t=m(e);return 0===t.length?(console.error("Not valid wrapper",e),this):(this.parent().mask(t),h(t[0]).nodes=this.toArray(),this.pushStack(t))}}),r(["empty","remove"],function(e){m.prototype[e]=function(){for(var t,n=0,r=this.length;r>n;n++)t=this[n],"empty"!==e?"remove"!==e||null!=t.parent&&o(t.parent.nodes,t):t.nodes=null;return this}}),n(m.prototype,{each:function(e,t){for(var n=0;this.length>n;n++)e.call(t||this,this[n],n);return this},eq:function(e){return-1===e?this.slice(e):this.slice(e,e+1)},get:function(e){return 0>e?this[this.length-e]:this[e]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),r(["filter","children","closest","parent","find","first","last"],function(e){m.prototype[e]=function(t){var n,r,o=[],i=null==t?null:l(t,this.type,"closest"===e?"up":"down");switch(e){case"filter":return m(f(this,i));case"children":for(n=0;this.length>n;n++)r=this[n],null!=r.nodes&&(o=o.concat(null==i?r.nodes:f(r.nodes,i)));break;case"parent":for(n=0;this.length>n;n++)r=this[n].parent,!r||r.type===v.FRAGMENT||i&&c(r,i)||o.push(r);w(o);break;case"closest":case"find":if(null==i)break;for(n=0;this.length>n;n++)d(this[n][i.nextKey],i,o);break;case"first":case"last":var s;for(n=0;this.length>n;n++)if(s="first"===e?n:this.length-n-1,r=this[s],null==i||c(r,i)){o[0]=r;break}}return this.pushStack(o)}}),m}(Mask);return Mask});