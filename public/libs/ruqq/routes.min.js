(function(e){function t(e){var t={};if(!e)return t;for(var n,r=0,o=e.split("&");o.length>r;r++)n=o[r].split("="),t[n[0]]=n[1];return t}function n(e,t){if(null==e)return null;for(var n,r,o=0,i=e.length;i>o;o++)if(n=e[o],n.match.test(t)){if(null==r){r=[n];continue}r.push(n)}return r}function r(e){this.root=e,this.rootRegexp=f(e),this.routes=[]}function o(e,t){if(null==t)return e;null==e&&(e={});for(var n in t)e[n]=t[n];return e}var i,l=[],s=function(){function e(e){return e.replace(/([\\\[\]\(\)])/g,"\\$1")}var t={":":"(/([^/]+))","?":"(/([^/]+))?","var":"([^/]+)"};return function(n){for(var r,o,i,l,s,u=n.match.split("/"),a="",c=2,f=0,p=u.length;p>f;f++)s=u[f],s?(i=s[0],l="?"===s[0],l&&(s=s.substring(1)),o=s.indexOf(":"),-1!==o&&(r=s.substring(0,o),a+=(a?"&":"")+s.substring(o+1)+"=$"+c,s=r+t["var"]),l||-1!==o?(u[f]="(/"+s+")"+(l?"?":""),c+=2):u[f]="/"+e(s)):(u.splice(f,1),f--,p--);return n.match=RegExp("^"+u.join("")),n.param=a,n}}(),u=function(e,n){if(e)for(var r,o=0,i=e.length;i>o;o++){r=e[o];var l=r.match.exec(n);l&&l.length&&r.callback(t(n.replace(r.match,r.param)),n)}},a=function(e,t){return e?t?("/"==t[0]&&(t=t.substring(1)),"/"==e[e.length-1]?e+t:e+"/"+t):e:t},c=function(){return(e.location.hash||"").replace(/^#\/?/,"/")},f=function(e){return e instanceof RegExp?e:("string"!=typeof e&&(console.error("Unsupported type",e),e=""),e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),RegExp("^"+e,"i"))};r.prototype={constructor:r,hashchanged:function(e){if(null==e&&(e=c(),"/"!==this.root)){if(this.rootRegexp.test(e)===!1)return;e=e.replace(this.rootRegexp,"")}l.push(e),u(this.routes,e)},add:function(e){if(null!=e){if("string"==typeof e)return this.add({match:e,callback:arguments[1]}),void 0;for(var t=e instanceof Array,n=t?e.length:1,r=null,o=0;n>o;o++)r=t?e[o]:e,"string"==typeof r.match&&s(r),this.routes.push(r)}},clear:function(){this.routes=[]},navigate:function(t){e.location.hash=t?a(this.root,t):""},current:function(){var e=c(),r=n(this.routes,e),i={};if(null==r)return null;for(var l,s=0,u=r.length;u>s;s++)l=r[s],i=o(i,t(e.replace(l.match,l.param)));return i},createHandler:function(e){e=e.replace(/(^[\/]+)|([\/]+$)/g,"");var t=a(this.root,e),n=new r(t);return this.add(e,function(e,r){n.hashchanged(r.replace(t,""))}),n},back:function(){if(!(2>l.length)){var e=(l.pop(),l.pop());this.navigate(e)}},stack:function(){return l}},e.routes=i=new r("/"),e.onhashchange=function(){i.hashchanged(c())}})(window);